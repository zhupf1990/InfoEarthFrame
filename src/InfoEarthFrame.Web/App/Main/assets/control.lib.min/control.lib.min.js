'use strict';app.directive('micBreadcrumb',function($state){return{restrict:'E',template:function(element,attrs){var templates='<ol class="breadcrumb {{breadclass}}">'+'<span>当前位置：</span>'+'<li ng-repeat="step in steps">'+'   <a ng-if="step.href" ui-sref="{{step.href}}">{{step.text}}</a>'+'   <span ng-if="!step.href">{{step.text}}</span>'+'</li>'+'</ol>';return templates;},scope:{breadclass:'=?'},replace:true,link:function(scope,element,attrs){scope.breadclass=angular.isUndefined(scope.breadclass)?'breadgreater':scope.breadclass;scope.steps=[];scope.steps.push({href:$state.current.name,text:$state.current.title});function recursion(current){if(!current.parentPage){return;}
var a=$state.get(current.parentPage);scope.steps.push({href:a.name,text:a.title});recursion(a);}
recursion($state.current);scope.steps.push({href:false,text:$state.$current.parent.title});scope.steps.reverse();}};});;'use strict';app.directive('isdisabled',function($timeout){return{restrict:'AE',template:function(elem,attr){var dom=elem.context.outerHTML;elem.context.className="";attr.ngClick="";dom=dom.replace('isdisabled="'+attr.isdisabled+'"','disabled ng-class="'+attr.isdisabled+'?\'\':\'button-display\'"');elem.context.outerHTML='<div style="cursor: not-allowed; display: inline-block;">'+
dom+'</div>'+
dom.replace('disabled ng-class="'+attr.isdisabled+'?\'\':\'button-display\'"','ng-class="'+attr.isdisabled+'?\'button-display\':\'\'"');return elem.context.outerHTML;},link:function(scope,elem,attr){}}});;'use strict';app.directive('micCalendar',function(){return{restrict:'E',template:function(element,attr){var el='   <input type="text" style=" width:100%; height:34px;" ng-model="dateSelected" mobiscroll-calendar="option" mobiscroll-instance="democalendar" placeholder="请选择日期..." />';if(angular.isDefined(attr.section)){el='   <input type="text" style=" width:100%; height:34px;" ng-model="dateSelected" mobiscroll-range="option" mobiscroll-instance="democalendarss" placeholder="请选择日期..." />';}
var tmp='<div class="calendar-div">'+el+'   <span class="spanbtn">'+'       <i class="fa fa-calendar "></i>'+'   </span>'+'</div>';return tmp;},scope:{dateSelected:'=',dateFormat:'@?',min:'@?',max:'@?',onHide:'=?'},replace:true,controller:['$scope',function($scope){$scope.option={theme:'bootstrap',lang:'zh',display:'left',controls:['calendar'],showScrollArrows:true,showLabel:true,etOnTap:true,buttons:["set",{text:"今天",handler:"now"},"cancel"],dateFormat:$scope.dateFormat?$scope.dateFormat:'yyyy-mm-dd',timeFormat:'HH:ii:ss',dateOrder:'ymmdd',timeWheels:'HHiiss',min:$scope.min?$scope.min:new Date('1970'),max:$scope.max?$scope.max:new Date('2525'),onCancel:function(){},onHide:function(a,b){$scope.onHide&&angular.isFunction($scope.onHide)&&$scope.onHide(b.getVal());},onShow:function(a,b){},};$scope.democalendar='calendarTime';$scope.democalendarss='rangeBasic';}]}});;'use strict';app.directive('maxlength',function(){return{restrict:'A',link:function($scope,$element,$attributes){var limit=$attributes.maxlength;$element.bind('keyup',function(event){var element=$element.closest(".form-group");element.toggleClass('has-warning',limit-$element.val().length<=10);element.toggleClass('has-error',$element.val().length>=limit);});$element.bind('keypress',function(event){if($element.val().length>=limit){if(event.keyCode!=8){event.preventDefault();}}});}};});;(function(){'use strict';app.directive('clipChat',ClipChat);function ClipChat(){var chatTemplate='<div>'+'<ol class="discussion">'+'<li class="messages-date" ng-repeat-start="message in newChatArray()" ng-if="displayDate($index) || $index == 0">{{message.date | amDateFormat:\'dddd, MMM D, h:mm a\'}}</li>'+'<li ng-class="{\'self\' : message.idUser == idSelf, \'other\' : message.idUser !== idSelf, \'nextSame\': newChatArray()[$index+1].idUser == message.idUser && !nextDate($index)}" ng-repeat-end>'+'<div class="message">'+'<div class="message-name" ng-if="newChatArray()[$index-1].idUser !== message.idUser || displayDate($index)">{{  message.user }}</div>'+'<div class="message-text">{{ message.content }}</div>'+'<div class="message-avatar"><img ng-src="{{ message.avatar }}" alt=""></div>'+'</div>'+'</li>'+'</ol>';var directive={restrict:'EA',template:chatTemplate,replace:true,scope:{messages:"=",idSelf:"=",idOther:"="},link:function($scope,$element,$attrs){$scope.newChatArray=function(){var filtered=[];for(var i=0;i<$scope.messages.length;i++){var item=$scope.messages[i];if((item.idUser==$scope.idSelf||item.idOther==$scope.idSelf)&&(item.idUser==$scope.idOther||item.idOther==$scope.idOther)){filtered.push(item);}}
return filtered;};$scope.displayDate=function(i){var prevDate,nextDate,diffMs,diffMins;var messages=$scope.newChatArray();if(i===0){if(messages.length>1){prevDate=new Date(messages[i].date);nextDate=new Date(messages[i+1].date);diffMs=(nextDate-prevDate);diffMins=Math.round(((diffMs%86400000)%3600000)/60000);}else{return true}}else{prevDate=new Date(messages[i-1].date);nextDate=new Date(messages[i].date);diffMs=(nextDate-prevDate);diffMins=Math.round(((diffMs%86400000)%3600000)/60000);}
if(diffMins>1){return true;}else{return false;}};$scope.nextDate=function(i){var prevDate,nextDate,diffMs,diffMins;var messages=$scope.newChatArray();if(i<messages.length-1){prevDate=new Date(messages[i].date);nextDate=new Date(messages[i+1].date);diffMs=(nextDate-prevDate);diffMins=Math.round(((diffMs%86400000)%3600000)/60000);}
if(diffMins>1){return true;}else{return false;}};}};return directive;}
app.directive('chatSubmit',SubmitChat);function SubmitChat(){var submitTemplate='<form ng-submit="submitChat()">'+'<div class="message-bar">'+'<div class="message-inner">'+'<a href="#" class="link icon-only"><i class="fa fa-camera"></i></a>'+'<div class="message-area"><input placeholder="Message" ng-model="ngModel" /></div>'+'<a translate="offsidebar.chat.SEND" href="#" class="link ng-scope" ng-click="submitChat()">Send</a>'+'</div>'+'</div>'+'</form>'+'</div>';var directive={restrict:'EA',template:submitTemplate,replace:true,scope:{submitFunction:"=",ngModel:"="},link:function($scope,$element,$attrs){$scope.submitChat=function(){$scope.submitFunction();if(typeof $attrs.scrollElement!=="undefined"){var scrlEl=angular.element($attrs.scrollElement);var lastElement=scrlEl.find('.discussion > li:last');if(lastElement.length)
scrlEl.scrollToElementAnimated(lastElement);}};}};return directive;}})();;'use strict';app.directive('checkBox',function(){var templates='<div class="checkbox clip-check check-primary">'+'<input type="checkbox" id="{{CheckBox.aid}}" '+'name="{{ CheckBox.aname }}"'+'ng-true-value="{{ CheckBox.aTrueValue }}" '+'ng-false-value="{{ CheckBox.aFalseValue }}" '+'ng-click="CheckBox.aClick()" '+'ng-checked="{{ CheckBox.achecked }}" '+'ng-disabled="{{ CheckBox.adisabled }}" '+' >'+'<label for="{{CheckBox.aid}}" ng-transclude></label>'+'</div>';return{restrict:'E',repuire:'ngModel',template:templates,scope:{aid:'@?',aname:'@?',aClick:'&?',achecked:'=?',aFalseValue:'@?',aTrueValue:'@?',adisabled:'=?',},link:function(scope,elem,attr,ngmodel){console.log(ngmodel);},controller:CheckBoxController,controllerAs:'CheckBox',bindToController:true,transclude:true,replace:true}});CheckBoxController.$inject=['$scope','$timeout'];function CheckBoxController($scope,$timeout){var CheckBox=this;var timer;CheckBox.triggerNgChange=triggerNgChange;$scope.$on('$destroy',function(){$timeout.cancel(timer);});init();function getCheckboxHasChildren(){return checkboxHasChildren;}
function init(){CheckBox.aid=angular.isUndefined(CheckBox.aid)?null:CheckBox.aid;CheckBox.aTrueValue=angular.isUndefined(CheckBox.aTrueValue)?true:CheckBox.aTrueValue;CheckBox.aFalseValue=angular.isUndefined(CheckBox.aFalseValue)?false:CheckBox.aFalseValue;CheckBox.adisabled=angular.isUndefined(CheckBox.adisabled)?false:CheckBox.adisabled;}
function checkboxClick($event,id){if($scope.checkeds.indexOf(id)==-1){$event.target.parentElement.classList.add("click-ban");$scope.checkeds.push(id);}
else{if($event.target.parentElement.className.indexOf("click-ban")>-1){$event.target.parentElement.classList.remove("click-ban");$event.target.checked="checked";}
else{$scope.checkeds.splice(0,1);}}}
function setCheckboxHasChildren(_checkboxHasChildren){checkboxHasChildren=_checkboxHasChildren;}
function triggerNgChange(){console.log(1);}};'use strict';app.directive('compareTo',function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(scope,element,attributes,ngModel){ngModel.$validators.compareTo=function(modelValue){return modelValue==scope.otherModelValue;};scope.$watch("otherModelValue",function(){ngModel.$validate();});}};});;'use strict';app.directive('ctDismiss',function(){return{restrict:'A',link:function(scope,elem,attrs){elem.on('click',function(e){elem.parent('.'+attrs.ctDismiss).hide();e.preventDefault();});}};});;'use strict';app.directive('micDistrict',function($timeout){return{restrict:'E',template:function(el,attrs){var tmp='<div><mic-ui-modals popwinmodal="inputModal" template="template" popwin-icon="\'districts-title-color\'" popwin-title="\'行政区划选择\'" size="lg" win-class="districts-popwin" backdrop="" resolve="" on-opened="openedBack" on-submit="submitForm"><span class="btn btn-primary btn-o district-span-ts">行政区划选择······</span></mic-ui-modals></div>';return tmp;},scope:{selectedModel:'=',districtCode:'=?',onSelect:'=?',onAllSelected:'=?'},controller:['$rootScope','$scope','$element','abp.services.app.area','$cacheFactory',function($rootScope,$scope,$element,area,$cacheFactory){if(!$rootScope.DistrictCache){$rootScope.DistrictCache=$cacheFactory('District');}
var tempshowCity={},tempshowCounty={},tempshowTown={},selectedModel={provincesData:[],cityData:[],countyData:[],townsData:[],};if(angular.isUndefined($scope.selectedModel)){$scope.selectedModel=angular.copy(selectedModel);}
$scope.template='<div class="form-horizontal">'+'   <div class="form-group districts-contents"><div class="col-sm-8 districts-left">'+'                <!-- 选择省级 -->'+'                <div class="search-areas" ng-class="{\'search-hide\': popwinmodal.data.prov.length===0}" >'+'                    <label class="search-titles">选择省：</label>'+'                    <div class="search-contents">'+'                        <ul>'+'                            <li ng-repeat="oneprov in popwinmodal.data.prov">'+'                                <a class="btn items" href="javascript:;" ng-class="{\'btn-primary\':oneprov.isChecked}" ng-click="popwinmodal.toCity(oneprov)">'+'                                    {{oneprov.districtName}}'+'                                </a>'+'                            </li>'+'                        </ul>'+'                    </div>'+'                </div>'+'                <div class="search-lines" ng-class="{\'search-hide\':popwinmodal.data.city.length===0}"></div>'+'                <!-- 选择市级 -->'+'                <div class="search-areas" ng-class="{\'search-hide\':popwinmodal.data.city.length===0}">'+'                    <label class="search-titles">选择市：</label>'+'                    <div class="btn-group select-btns"  ng-class="{\'search-hide\': popwinmodal.data.prov.length===0}" >'+'                        <label class="btn" ng-class="popwinmodal.s1?\'btn-primary\':\'btn-default\'" style="font-size: 12px; padding: 2px 8px;border-right:none;" ng-click="popwinmodal.selectAllCity(true)">全选</label>'+'                        <label class="btn" ng-class="popwinmodal.s1===false?\'btn-primary\':\'btn-default\'"  style="font-size: 12px;padding: 2px 8px; border-left-color:#c8c7cc !important" ng-click="popwinmodal.selectAllCity(false)">反选</label></div>'+'                    <div class="search-contents">'+'                        <ul>'+'                            <li ng-repeat="onecity in popwinmodal.data.city">'+'                                <a class="btn items" href="javascript:;" ng-class="{\'btn-primary\':onecity.isChecked}" ng-click="popwinmodal.toCounty(onecity)">'+'                                    {{onecity.districtName}}'+'                                </a>'+'                            </li>'+'                        </ul>'+'                    </div>'+'                </div>'+'                <div class="search-lines" ng-class="{\'search-hide\':popwinmodal.data.county.length===0}"></div>'+'                <!-- 选择县级 -->'+'                <div class="search-areas" ng-class="{\'search-hide\':popwinmodal.data.county.length===0}">'+'                    <label class="search-titles">选择县：</label>'+'                    <div class="btn-group select-btns" ng-class="{\'search-hide\':popwinmodal.data.city.length===0}">'+'                        <label class="btn" ng-class="popwinmodal.s2?\'btn-primary\':\'btn-default\'" style="font-size: 12px;padding: 2px 8px;border-right:none;" ng-click="popwinmodal.selectAllCounty(true)">全选</label>'+'                        <label class="btn" ng-class="popwinmodal.s2===false?\'btn-primary\':\'btn-default\'"  style="font-size: 12px;padding: 2px 8px; border-left-color:#c8c7cc !important" ng-click="popwinmodal.selectAllCounty(false)">反选</label></div>'+'                    <div class="search-contents">'+'                        <ul>'+'                            <li ng-repeat="onecounty in popwinmodal.data.county">'+'                                <a class="btn items" href="javascript:;" ng-class="{\'btn-primary\':onecounty.isChecked}" ng-click="popwinmodal.toTowns(onecounty)">'+'                                    {{onecounty.districtName}}'+'                                </a>'+'                            </li>'+'                        </ul>'+'                    </div>'+'                </div>'+'                <div class="search-lines" ng-class="{\'search-hide\':popwinmodal.data.town.length===0}"></div>'+'                <!-- 选择乡镇级 -->'+'                <div class="search-areas" ng-class="{\'search-hide\':popwinmodal.data.town.length===0}">'+'                    <label class="search-titles">选择乡镇：</label>'+'                    <div class="btn-group select-btns">'+'                        <label class="btn" ng-class="popwinmodal.s3?\'btn-primary\':\'btn-default\'" style="font-size: 12px;padding: 2px 8px;border-right:none;" ng-click="popwinmodal.selectAllTown(true)">全选</label>'+'                        <label class="btn" ng-class="popwinmodal.s3===false?\'btn-primary\':\'btn-default\'"  style="font-size: 12px;padding: 2px 8px; border-left-color:#c8c7cc !important" ng-click="popwinmodal.selectAllTown(false)">反选</label></div>'+'                    <div class="search-contents" ng-class="{\'height272\':popwinmodal.townStyle===272,\'height432\':popwinmodal.townStyle===432}">'+'                        <ul>'+'                            <li ng-repeat="onetown in popwinmodal.data.town">'+'                                <a class="btn items" href="javascript:;" ng-class="{\'btn-primary\':onetown.isChecked}" ng-click="popwinmodal.forTown(onetown)">'+'                                    {{onetown.townName}}'+'                                </a>'+'                            </li>'+'                        </ul>'+'                    </div>'+'                </div>'+'</div><div class="col-sm-4  districts-right" style="padding-left: 0px;">'+'<div class="panel-white panel-heading border-light" style="padding-top: 11px;min-height: 42px;max-height: 42px;border-bottom:solid 1px rgba(0, 0, 0, 0.07) !important;">'+'<h4 class="panel-title districts-title-color" style="line-height: 1.4;">行政区划选择结果树展示</h4>'+'<ul class="panel-heading-tabs border-light">'+'   <li class="panel-tools" style="height: 39px;line-height: 3.56666;">'+'       <a href="javascript:void(0)" ng-init="isshow1=true" ng-click="isshow1=!isshow1">'+'           <i ng-if="isshow1===true" class="ti-plus" tooltip="展开" ng-click="popwinmodal.treeCtrl.expand_all()"></i><i ng-if="isshow1===false" class="ti-minus" tooltip="收缩" ng-click="popwinmodal.treeCtrl.collapse_all()"></i>'+'       </a>'+'   </li></ul>'+'</div>'+'<div class="districts-tree">'+'<abn-tree tree-data="popwinmodal.treeData" on-select="popwinmodal.onTreeonSelected" expand-level="2" tree-control="popwinmodal.treeCtrl"></abn-tree></div>'+'</div></div>'+'   <div class="form-group" style="border-top: 1px solid rgba(27, 26, 26, 0.11);padding-top: 15px;margin-top: 0px;margin-bottom: 0px;">'+'       <div class="col-sm-6 districts-foot-bottom"><a style="float: left;margin-left: 15px;min-width: 80px;" class="btn btn-wide btn-o btn-default" ng-click="submitForm.submit({$invalid:false,isall:false})">取消全选</a>'+'       <button style="min-width: 80px; float: left; margin-left: 0.5em;" class="btn btn-wide btn-primary" ng-click="submitForm.submit({$invalid:false,isall:true})">全部选中</button>'+'       </div><div class="col-sm-6"><button type="submit" style="min-width: 80px;margin-right: 15px; float: right; margin-left: 0.5em; " class="btn btn-wide btn-primary" ng-click="submitForm.submit({$invalid:false})">确定</button>'+'       <a style="float: right; min-width: 80px;" class="btn btn-wide btn-o btn-default" ng-click="submitForm.cancel()">取消</a>'+'</div></div></div>';$scope.inputModal={s1:undefined,s2:undefined,s3:undefined,selectAllCity:function(bo){if($scope.inputModal.s1!==bo){var cityCodes=[];var copycity={checked:[],noChecked:[]};for(var n in $scope.inputModal.data.city){if(!$scope.inputModal.data.city[n].isChecked){cityCodes.push($scope.inputModal.data.city[n].districtCode);copycity.noChecked.push($scope.inputModal.data.city[n]);}else{copycity.checked.push($scope.inputModal.data.city[n]);}
$scope.inputModal.data.city[n].isChecked=bo;}
if(bo){area.getCounty({token:AccessTokenValues,cityCodes:cityCodes}).success(function(data,statue){var tpm={};for(var x in cityCodes){var c="d"+cityCodes[x];var arr=[];var subs=c.substr(0,5);for(var y in data){if(('d'+data[y].districtCode).lastIndexOf(subs)===0){arr.push(data[y]);}}
tpm[c]=arr;}
tempshowCounty=angular.copy(tpm);$scope.inputModal.data.county=getShow(tempshowCounty);});var cdt=angular.copy($scope.inputModal.data.city);selectedModel.cityData=cdt;if($scope.inputModal.toCity===null){$scope.inputModal.treeData=angular.copy(cdt);}else{for(var t in copycity.noChecked){var cd="d"+copycity.noChecked[t].districtCode;treeRecursion($scope.inputModal.treeData,1,true,cd,3,0,copycity.noChecked[t]);}}}else{tempshowCounty={};tempshowTown={};selectedModel.cityData=[];selectedModel.countyData=[];selectedModel.townsData=[];$scope.inputModal.data.county=[];$scope.inputModal.data.town=[];if($scope.inputModal.toCity===null){$scope.inputModal.treeData=[];}else{for(var t in copycity.checked){var cd="d"+copycity.checked[t].districtCode;treeRecursion($scope.inputModal.treeData,1,false,cd,3,0);}}}
$scope.inputModal.s2=undefined;}
$scope.inputModal.s1=bo;},selectAllCounty:function(bo){if($scope.inputModal.s2!==bo){var countyCodes=[];var copycounty={checked:[],noChecked:[]};for(var n in $scope.inputModal.data.county){if(!$scope.inputModal.data.county[n].isChecked){countyCodes.push($scope.inputModal.data.county[n].districtCode);copycounty.noChecked.push($scope.inputModal.data.county[n]);}else{copycounty.checked.push($scope.inputModal.data.county[n]);}
$scope.inputModal.data.county[n].isChecked=bo;}
if(bo){area.getTowns({token:AccessTokenValues,countyCodes:countyCodes}).success(function(data,statue){var tpm={};for(var x in countyCodes){var c="d"+countyCodes[x];var arr=[];var subs=c.substr(0,7);for(var y in data){if(('d'+data[y].districtCode).lastIndexOf(subs)===0){arr.push(data[y]);}}
tpm[c]=arr;}
tempshowTown=angular.copy(tpm);$scope.inputModal.data.town=getShow(tempshowTown);});var countydt=angular.copy($scope.inputModal.data.county);selectedModel.countyData=countydt;if($scope.inputModal.toCounty===null){$scope.inputModal.treeData=angular.copy(countydt);}else{var lev=2,subt=3;if($scope.inputModal.toCity===null){lev=1,subt=5;}
for(var t in copycounty.noChecked){var cd="d"+copycounty.noChecked[t].districtCode;treeRecursion($scope.inputModal.treeData,lev,true,cd,subt,0,copycounty.noChecked[t]);}}}else{tempshowTown={};selectedModel.countyData=[];selectedModel.townsData=[];$scope.inputModal.data.town=[];if($scope.inputModal.toCounty===null){$scope.inputModal.treeData=[];}else{var lev=2,subt=3;if($scope.inputModal.toCity===null){lev=1,subt=5;}
for(var t in copycounty.checked){var cd="d"+copycounty.checked[t].districtCode;treeRecursion($scope.inputModal.treeData,lev,false,cd,subt,0);}}}
$scope.inputModal.s3=undefined;}
$scope.inputModal.s2=bo;},selectAllTown:function(bo){if($scope.inputModal.s3!==bo){var copytown={checked:[],noChecked:[]};for(var n in $scope.inputModal.data.town){if(!$scope.inputModal.data.town[n].isChecked){copytown.noChecked.push($scope.inputModal.data.town[n]);}else{copytown.checked.push($scope.inputModal.data.town[n]);}
$scope.inputModal.data.town[n].isChecked=bo;}
var lev=3,subt=3;if($scope.inputModal.toCounty===null){lev=1,subt=7;}else if($scope.inputModal.toCity===null){lev=2,subt=5;}
if(bo){var towndt=angular.copy($scope.inputModal.data.town);selectedModel.townsData=towndt;for(var t in copytown.noChecked){var cd="d"+copytown.noChecked[t].districtCode;treeRecursion($scope.inputModal.treeData,lev,true,cd,subt,0,copytown.noChecked[t]);}}else{selectedModel.townsData=[];for(var t in copytown.checked){var cd="d"+copytown.checked[t].districtCode;treeRecursion($scope.inputModal.treeData,lev,false,cd,subt,0);}}}
$scope.inputModal.s3=bo;},toCity:function(dt){$scope.inputModal.s1=undefined;dt.isChecked=!dt.isChecked;var code="d"+dt.districtCode;if(dt.isChecked){tempshowCity[code]=angular.copy($rootScope.DistrictCache.get(code));if(!tempshowCity[code]){area.getCity({token:AccessTokenValues,proviceCode:dt.districtCode}).success(function(data,statue){tempshowCity[code]=angular.copy(data);$rootScope.DistrictCache.put(code,data);$scope.inputModal.data.city=getShow(tempshowCity);});}else{$scope.inputModal.data.city=getShow(tempshowCity);}
var prcdt=angular.copy(dt);selectedModel.provincesData=selectedModel.provincesData.concat(prcdt);$scope.inputModal.treeData.push(prcdt);}else{tempshowCity[code]=[];var down=code.substr(0,3);$scope.inputModal.data.city=getShow(tempshowCity);$scope.inputModal.data.county=closeDown(tempshowCounty,down);$scope.inputModal.data.town=closeDown(tempshowTown,down);for(var i in selectedModel.provincesData){if(selectedModel.provincesData[i].districtCode==dt.districtCode){selectedModel.provincesData.splice(i,1);$scope.inputModal.treeData.splice(i,1);break;}}
closeChoose(selectedModel.cityData,down);closeChoose(selectedModel.countyData,down);closeChoose(selectedModel.townsData,down);}},toCounty:function(dt){$scope.inputModal.s1=undefined;$scope.inputModal.s2=undefined;dt.isChecked=!dt.isChecked;var code="d"+dt.districtCode;if(dt.isChecked){tempshowCounty[code]=angular.copy($rootScope.DistrictCache.get(code));if(!tempshowCounty[code]){area.getCounty({token:AccessTokenValues,cityCode:dt.districtCode}).success(function(data,statue){tempshowCounty[code]=angular.copy(data);$rootScope.DistrictCache.put(code,data);$scope.inputModal.data.county=getShow(tempshowCounty);});}else{$scope.inputModal.data.county=getShow(tempshowCounty);}
var citydt=angular.copy(dt);selectedModel.cityData=selectedModel.cityData.concat(citydt);if($scope.inputModal.toCity===null){$scope.inputModal.treeData.push(citydt);return;}
treeRecursion($scope.inputModal.treeData,1,true,code,3,0,citydt);}else{tempshowCounty[code]=[];var down=code.substr(0,5);$scope.inputModal.data.county=getShow(tempshowCounty);$scope.inputModal.data.town=closeDown(tempshowTown,down);for(var k in selectedModel.cityData){if(selectedModel.cityData[k].districtCode==dt.districtCode){selectedModel.cityData.splice(k,1);if($scope.inputModal.toCity===null){$scope.inputModal.treeData.splice(k,1);}else{treeRecursion($scope.inputModal.treeData,1,false,code,3,0);}
break;}}
closeChoose(selectedModel.countyData,down);closeChoose(selectedModel.townsData,down);}},toTowns:function(dt){$scope.inputModal.s2=undefined;$scope.inputModal.s3=undefined;dt.isChecked=!dt.isChecked;var code="d"+dt.districtCode;if(dt.isChecked){tempshowTown[code]=angular.copy($rootScope.DistrictCache.get(code));if(!tempshowTown[code]){area.getTowns({token:AccessTokenValues,countyCode:dt.districtCode}).success(function(data,statue){tempshowTown[code]=angular.copy(data);$rootScope.DistrictCache.put(code,data);$scope.inputModal.data.town=getShow(tempshowTown);});}else{$scope.inputModal.data.town=getShow(tempshowTown);}
var countydt=angular.copy(dt);selectedModel.countyData=selectedModel.countyData.concat(countydt);if($scope.inputModal.toCounty===null){$scope.inputModal.treeData.push(countydt);return;}else if($scope.inputModal.toCity===null){treeRecursion($scope.inputModal.treeData,1,true,code,5,0,countydt);return;}
treeRecursion($scope.inputModal.treeData,2,true,code,3,0,countydt);}else{tempshowTown[code]=[];$scope.inputModal.data.town=getShow(tempshowTown);for(var i in selectedModel.countyData){if(selectedModel.countyData[i].districtCode===dt.districtCode){selectedModel.countyData.splice(i,1);if($scope.inputModal.toCounty===null){$scope.inputModal.treeData.splice(i,1);}else if($scope.inputModal.toCity===null){treeRecursion($scope.inputModal.treeData,1,false,code,5,0);}else{treeRecursion($scope.inputModal.treeData,2,false,code,3,0);}
break;}}
closeChoose(selectedModel.townsData,code.substr(0,7));}},forTown:function(dt){$scope.inputModal.s3=undefined;dt.isChecked=!dt.isChecked;var code="d"+dt.townCode,lev=3,subt=3;if($scope.inputModal.toCounty===null){lev=1,subt=7;}else if($scope.inputModal.toCity===null){lev=2,subt=5;}
if(dt.isChecked){var tdt=angular.copy(dt);selectedModel.townsData=selectedModel.townsData.concat(tdt);treeRecursion($scope.inputModal.treeData,lev,true,code,subt,0,tdt);}else{for(var i in selectedModel.townsData){if(selectedModel.townsData[i].districtCode==dt.districtCode){selectedModel.townsData.splice(i,1);treeRecursion($scope.inputModal.treeData,lev,false,code,subt,0);return;}}}},treeData:[],treeCtrl:{},onTreeonSelected:function(){},selectAll:function(bo){console.log(bo);},cancelAll:function(bo){console.log(bo);},data:{prov:[],city:[],county:[],town:[]}};_initLoadDt();function _initLoadDt(){var caches=angular.copy($rootScope.DistrictCache.get('districtCaches'));if(!!$scope.districtCode&&$scope.districtCode!='000000'){var str='d'+angular.copy($scope.districtCode);if(str.substring(3)==='0000'){$scope.inputModal.data.city=caches;if(!$scope.inputModal.data.city){area.getCity({token:AccessTokenValues,proviceCode:$scope.districtCode}).success(function(data,statue){$rootScope.DistrictCache.put('districtCaches',data);$scope.inputModal.data.city=angular.copy(data);});}
$scope.inputModal.townStyle=272;$scope.inputModal.toCity=null;return;}else if(str.substring(5)==='00')
$scope.inputModal.data.county=caches;if(!$scope.inputModal.data.county){area.getCounty({token:AccessTokenValues,cityCode:$scope.districtCode}).success(function(data,statue){$rootScope.DistrictCache.put('districtCaches',data);$scope.inputModal.data.county=angular.copy(data);});}
$scope.inputModal.townStyle=432;$scope.inputModal.toCounty=null;return;}
$scope.inputModal.data.prov=caches;if(!$scope.inputModal.data.prov){area.getProvinces({token:AccessTokenValues}).success(function(data,statue){$rootScope.DistrictCache.put('districtCaches',data);$scope.inputModal.data.prov=angular.copy(data);});}}
function treeRecursion(node,level,bo,code,subInt,_i,dt){_i++;var str=code.substr(0,subInt);for(var i in node){var dstr="d"+node[i].districtCode;if(dstr.lastIndexOf(str)===0){if(level===_i){if(bo){node[i].children.push(dt);}
else{for(var j in node[i].children){if(("d"+node[i].children[j].districtCode)===code){node[i].children.splice(j,1);break;}}}}else{if(subInt===3){subInt=5;}else if(subInt===5){subInt=7;}else if(subInt===7){subInt=10;}
treeRecursion(node[i].children,level,bo,code,subInt,_i,dt);}
break;}}}
$scope.submitForm=function(modalInstance,from){if(from.isall===true){setState(/······/g,'(已全选)');!!$scope.onAllSelected?$scope.onAllSelected(true):null;}else if(from.isall===false){setState(/\(已全选\)/g,'······');!!$scope.onAllSelected?$scope.onAllSelected(false):null;}else{setState(/\(已全选\)/g,'······');$scope.selectedModel=angular.copy(selectedModel);$timeout(function(){!!$scope.onSelect?$scope.onSelect(selectedModel):null;},10);}
modalInstance.close();};function setState(restr,str){var elem=$element.find('.district-span-ts');var t=elem.text().replace(restr,str);elem.text(t);}
$scope.openedBack=function(){};function getShow(obj){var temp=[];for(var i in obj){temp=temp.concat(obj[i]);}
return temp;}
function closeDown(data,down){for(var j in data){if(j.lastIndexOf(down)===0){data[j]=[];}}
return getShow(data);}
function closeChoose(data,down){var len=data.length;for(var d=0;d<len;d++){if(!data[d]){return;}
var cd='d'+data[d].districtCode;if(cd.lastIndexOf(down)===0){data.splice(d,1);d--;}}}}],replace:true}});;'use strict';app.directive('a',function(){return{restrict:'E',link:function(scope,elem,attrs){if(attrs.ngClick||attrs.href===''||attrs.href==='#'){elem.on('click',function(e){e.preventDefault();});}}};});;'use strict';app.factory('DragServer',function($document,$timeout){function DragServer(classsStr,backFun){this.template='';if(!classsStr){console.log('classsStr为空时，开发者须自定义落点促发的方法体，即droppable()方法  -_-!');return;}
$timeout(function(){$document.find('.'+classsStr).droppable({drop:function(a,b){backFun(a,b);}});});};DragServer.prototype.go=function(event){if(!event||!this.template){console.error('错误:   $event参数未传入或者未添加模板!');return;}
var el=angular.element(this.template);el.draggable({stop:function(){el.remove();}});el.css('left',(event.clientX-2.6)+'px');el.css('top',(event.clientY-2.6)+'px');el.on('mouseup',function(event){el.remove();});$document.find('body').append(el);event.type='mousedown';el.trigger(event);};return DragServer;});;'use strict';app.factory('MicTablesServer',function(){function MicTablesServer(options){this._opt=options;};MicTablesServer.prototype._createTableCell=function(){var html='',params='',thead=angular.isDefined(this._opt.attrs.thead)?this._opt.attrs.thead.replace(/,/g,'</div></th><th><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">'):'';if(angular.isDefined(this._opt.attrs.tdParams)){params=this._opt.attrs.tdParams.replace(/\[\]/g,'null').replace(/'/g,'"');params=angular.fromJson(params);var i=1;for(var key in params){if(!params[key]){html+='<td><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">{{'+this._opt.row+'.'+key+'}}</div></td>';continue;}
var a=params[key],b="",icon="",tip="";if(a.icon){icon='<i class="'+a.icon+'"></i>';}
if(a.tip){tip='tooltip="'+a.tip+'" tooltip-append-to-body';}
var strs=this._opt.row+'.isShowInput['+i+']';var clickstr='ng-click="'+strs+'=true;'+this._opt.cellFunName+'('+this._opt.row+',\''+key+'\',$event,true)"';var strss='<{{type}} '+tip+' ng-class="{\'input-display\':'+strs+'}"  style="margin:0px 2px;" '+clickstr+'>'+icon+'{{'+this._opt.row+'.'+key+'}}</{{type}}>';var editstr='<input class="form-control" type="text" ng-model="'+this._opt.row+'.'+key+'" ng-blur="'+strs+'=false" ng-class="{\'input-display\':!'+strs+'}" ng-keyup="keydownTableInput('+this._opt.row+', $event,'+i+')" />'+strss;if(a.iseditnum){a.isedit=true;editstr='<num-box text-model="'+this._opt.row+'.'+key+'" ng-blur="'+strs+'=false" ng-class="{\'input-display\':!'+strs+'}" ng-keyup="keydownTableInput('+this._opt.row+', $event,'+i+')" ></num-box>'+strss;}
b+=a.isclick?a.isedit?editstr:'<{{type}} '+tip+' style="margin:0px 2px;" ng-click="'+this._opt.cellFunName+'('+this._opt.row+',\''+key+'\',$event)">'+icon+'{{'+this._opt.row+'.'+key+'}}</{{type}}>':'<{{type}} style="margin:0px 2px;">{{'+this._opt.row+'.'+key+'}}</{{type}}>';b=b.replace(/{{type}}/g,a.type);html+='<td '+(a.width&&i===1?'style="width:'+a.width+';" ':'')+(a.isedit?clickstr:'')+'ng-class="{\'td-paddingSX0\':'+strs+'}"><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">'+b+'</div></td>';i++;}}
return{thead:thead,td:html};};MicTablesServer.prototype._createTableBtn=function(){var html='',thead='';if(angular.isDefined(this._opt.attrs.tableBtnHtml)){var p=this._opt.attrs.tableBtnHtml.replace(/"/g,'&quot;').replace(/'/g,'"');p=angular.fromJson(p);var i=0;for(var o in p){i++;var str=p[o].param?'ng-show="'+this._opt.row+'.'+p[o].param+'"':'';if(!p[o].html){html+='<a style="margin-right: 10px;" '+str+' ng-click="'+this._opt.btnFunName+'('+this._opt.row+','+o+',\''+p[o].name+'\',$event)"><i class="'+p[o].icon+'"></i>'+p[o].text+'</a>';continue;}
var ht=p[o].html;ht=ht.replace(/&quot;/g,'"');var s=ht.replace(/</,'').replace(/>/,' ');s=s.split(' ')[0];ht=ht.replace('<'+s,'<'+s+'  '+str+' style="margin-right: 10px;" ng-click="'+this._opt.btnFunName+'('+this._opt.row+','+o+',\''+p[o].name+'\',$event)" ');html+=ht;}
i=32*i;if(i===32){i=45;}
i=i+'px';html='<td style="width:'+i+' ;"><div style="width:'+i+';text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">'+html+'</div></td>';thead='</div></th><th><div width="true" style="width:'+i+';text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">操作';}
return{thead:thead,td:html};};return MicTablesServer;});;'use strict';app.directive('ngThumb',['$window',function($window){var helper={support:!!($window.FileReader&&$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File;},isImage:function(file){var type='|'+file.type.slice(file.type.lastIndexOf('/')+1)+'|';return'|jpg|png|jpeg|bmp|gif|'.indexOf(type)!==-1;}};return{restrict:'A',template:'<canvas/>',link:function(scope,element,attributes){function onLoadFile(event){var img=new Image();img.onload=onLoadImage;img.src=event.target.result;}
function onLoadImage(){var width=params.width||this.width/this.height*params.height;var height=params.height||this.height/this.width*params.width;canvas.attr({width:width,height:height});canvas[0].getContext('2d').drawImage(this,0,0,width,height);}
var canvas;if(!helper.support)return;var params=scope.$eval(attributes.ngThumb);if(params.filePath){canvas=element.find('canvas');var img=new Image();img.onload=onLoadImage;img.src=params.filePath;return;}
if(!helper.isFile(params.file))return;if(!helper.isImage(params.file))return;canvas=element.find('canvas');var reader=new FileReader();reader.onload=onLoadFile;reader.readAsDataURL(params.file);}};}]);;'use strict';app.directive('foldTableBtn',function($timeout,selfadapt){return{restrict:'E',template:function(){var tep='<a class="btn btn-transparent btn-sm" ng-init="isshow=false" ng-click="isshow=!isshow;click(isshow)" tooltip="收缩" >'+'   <i  ng-class="isshow?\'ti-angle-double-up\':\'ti-angle-double-down\'" > </i> '+'</a>';return tep;},replace:true,scope:{foldElement:'='},link:function(scope,elem,attr){var pEl=scope.foldElement,str='#'+attr.foldId;if(!angular.isDefined(attr.foldId)||!attr.foldId){str='div.panel-fold div.panel-body';}
var panelBodyObj=pEl.find(str);scope.click=function(b){if(b){elem.attr('tooltip','展开');panelBodyObj.hide();}else{elem.attr('tooltip','收缩');panelBodyObj.show();}
var miss=scope.$watch(function(){return pEl.find('div.panel-fold').height();},function(){selfadapt.onChange(pEl);$timeout(function(){miss();},20);});}}};});;'use strict';app.directive('ctFullheight',['$window','$rootScope','$timeout','APP_MEDIAQUERY',function($window,$rootScope,$timeout,mq){return{restrict:"AE",scope:{ctFullheightIf:'&'},link:function(scope,elem,attrs){var $win=$($window);var $document=$(document);var exclusionItems;var exclusionHeight;var setHeight=true;var page;scope.initializeWindowSize=function(){$timeout(function(){exclusionHeight=0;if(attrs.ctFullheightIf){scope.$watch(scope.ctFullheightIf,function(newVal,oldVal){if(newVal&&!oldVal){setHeight=true;}else if(!newVal){$(elem).css('height','auto');setHeight=false;}});}
if(attrs.ctFullheightExclusion){var exclusionItems=attrs.ctFullheightExclusion.split(',');angular.forEach(exclusionItems,function(_element){exclusionHeight=exclusionHeight+$(_element).outerHeight(true);});}
if(attrs.ctFullheight=='window'){page=$win;}else{page=$document;}
scope.$watch(function(){scope.__height=page.height();});if(setHeight){$(elem).css('height','auto');if(page.innerHeight()<$win.innerHeight()){page=$win;}
$(elem).css('height',page.innerHeight()-exclusionHeight);}},300);};scope.initializeWindowSize();scope.$watch('__height',function(newHeight,oldHeight){scope.initializeWindowSize();});$win.on('resize',function(){scope.initializeWindowSize();});}};}]);;'use strict';app.directive('micLikeInput',function($timeout){return{restrict:'E',replace:true,template:function(el,attrs){var tmp='<div class="input-group">'+'<div class="fuzzy-matching" ng-class="{\'hide\':hideLeft}"><div class="left">'+'<ul>'+'<li ng-repeat="item in datasources" ng-click="itemClick(item)"><span>{{item}}</span>'+'</li>'+'</ul>'+'</div><div class="right"></div></div>'+'<input class="form-control" type="text" ng-model="value" ng-keyup="inputKeyup($event)">'+'<span class="input-group-btn">'+'<a href="javascript:;" class="btn btn-primary" ng-click="onSearch()">'+'查询'+'</a>'+'</span>'+'</div>';return tmp;},scope:{value:'=',datasets:'=',onSearchClick:'='},link:function(scope,el,attrs){var bo=false;scope.inputKeyup=function(evt){if(evt.keyCode===13){scope.onSearchClick();return;}};scope.itemClick=function(val){bo=true;scope.value=val;scope.datasources=[];};scope.onSearch=function(){scope.onSearchClick();};scope.$watch('value',function(val){if(bo){bo=false;return;}
if(!val){scope.datasources=[];return;}
var obj=angular.copy(scope.datasets);var arr=[];for(var o in obj){if(obj[o].indexOf(val)!==-1){arr.push(obj[o]);}}
scope.datasources=angular.copy(arr);});scope.$watch('datasources',function(val){scope.hideLeft=!val||val.length===0;});scope.$watch(function(){return el.width();},function(w){$timeout(function(){var setW=w-el.find('div.fuzzy-matching>.right').width()-1;el.find('div.fuzzy-matching>.left').width(setW);},20);});}};});;'use strict';app.directive('kneeCoordinate',function($state){return{restrict:'E',template:function(element,attrs){var date=new Date().getTime();var templates='<div>'+'    <style>'+'        @media (min-width:768px) {'+'            .testwinCls .modal-lg {'+'                width: 400px; /*设置弹出框宽*/'+'            }'+'            .testwinCls .modal-sm {'+'                width: 400px; /*设置弹出框宽*/'+'            }'+'            .testwinCls .modal-content {'+'                /*height: 900px;*/ /*设置弹出框高*/'+'            }'+'        }'+'        .testwinCls .modal-dialog {'+'            top: 26%; /*设置弹出位置距顶端*/'+'        }'+'    </style>'+'<div class="col-xs-10 col-sm-10 up-label" style="padding: 0">'+'    <label class="col-lg-3 col-sm-12 col-xs-12 title-label-border" style="padding: 10px 0 10px 15px; margin: 0;">'+'        拐点坐标'+'    </label>'+'    <div class="col-lg-7 col-sm-9 col-xs-12 title-mid-border" style="padding: 0 0 0 15px;">'+'        <div class="btn-group" style="padding-top: 8px;">'+'            <div class="radio clip-radio radio-primary radio-inline" style="margin: 0px !important">'+'                <input type="radio" id="r1'+date+'" name="inline" value="西安80坐标系" ng-model="kneeInputData.coordSys">'+'                <label for="r1'+date+'">'+'                    西安80'+'                </label>'+'            </div>'+'            <div class="radio clip-radio radio-primary radio-inline" style="margin: 0px !important">'+'                <input type="radio" id="r2'+date+'" name="inline" value="北京54坐标系" ng-model="kneeInputData.coordSys">'+'                <label for="r2'+date+'">'+'                    北京54'+'                </label>'+'            </div>'+'            <div class="radio clip-radio radio-primary radio-inline" style="margin: 0px !important">'+'                <input type="radio" id="r3'+date+'" name="inline" value="国家2000" ng-model="kneeInputData.coordSys">'+'                <label for="r3'+date+'">'+'                    国家2000'+'                </label>'+'            </div>'+'            <div class="radio clip-radio radio-primary radio-inline" style="margin: 0px !important">'+'                <input type="radio" id="r4'+date+'" name="inline" value="WGS84" checked ng-model="kneeInputData.coordSys">'+'                <label for="r4'+date+'">'+'                    WGS84'+'                </label>'+'            </div>'+'        </div>'+'    </div>'+'    <div class="col-lg-2 col-sm-3 col-xs-12 title-radio-border" style="padding: 0 0 0 15px;">'+'        <div class="btn-group" style="padding: 4px 0; width: 136px">'+'            <label class="btn" ng-class="{\'btn-primary\':!kneeInputData.isProjectiveGeo,\'btn-default\':!!kneeInputData.isProjectiveGeo}" style="padding: 4px 10px; border-right: none;" ng-click="kneeInputData.isProjectiveGeo = false">'+'                地理'+'            </label>'+'            <label class="btn" ng-class="{\'btn-primary\':!!kneeInputData.isProjectiveGeo,\'btn-default\':!kneeInputData.isProjectiveGeo}" style="padding: 4px 10px; border-left: none" ng-click="kneeInputData.isProjectiveGeo = true">'+'                投影'+'            </label>'+'        </div>'+'    </div>'+'</div>'+'<div class="col-xs-10 col-sm-10" style="padding: 0">'+'    <textarea class="form-control" placeholder="请输入拐点坐标值" ng-model="textModel" ng-click="ck()"></textarea>'+'</div>'+'</div>';return templates;},scope:{kneeInputData:'=?'},controller:['$scope','$timeout','FileUploader','SweetAlert','$modal',function($scope,$timeout,FileUploader,SweetAlert,$modal){var databack;function creatNewData(arr){var bo=arr.length<=3?false:true;for(var i=0;i<arr.length;i++){arr[i].number=i+1;arr[i].isshow=bo;}
return arr;}
function setTextarea(dt){var str='';for(var key in dt){str+=dt[key].number+':'+dt[key].coordinateX+','+dt[key].coordinateY+';';}
$scope.textModel=str;}
if($scope.kneeInputData){databack=creatNewData(angular.copy($scope.kneeInputData.initialData));$scope.kneeInputData.initialData=angular.copy(databack);setTextarea(angular.copy($scope.kneeInputData.initialData));$scope.kneeInputData.coordSys=angular.isUndefined($scope.kneeInputData.coordSys)?"WGS84":$scope.kneeInputData.coordSys;$scope.kneeInputData.isProjectiveGeo=angular.isUndefined($scope.kneeInputData.isProjectiveGeo)?false:$scope.kneeInputData.isProjectiveGeo;$scope.kneeInputData.initialData=angular.isUndefined($scope.kneeInputData.initialData)?[]:$scope.kneeInputData.initialData;}
var ctrl="kneeWindow";var tempModel={myData:$scope.kneeInputData.initialData,tabBtnParams:[{name:'插入',click:function(row){var arr=angular.copy(tempModel.myData);arr.splice((row.number),0,{coordinateX:0,coordinateY:0});tempModel.myData=creatNewData(arr);}},{name:'删除',click:function(row,b,c){var len=tempModel.myData.length;if(len===3){tempModel.myData[2].isshow=true;return;}
for(var k=0;k<len;k++){if(row.$$hashKey===tempModel.myData[k].$$hashKey){tempModel.myData.splice(k,1);break;}}
tempModel.myData=creatNewData(angular.copy(tempModel.myData));}}],myDataClickBak:function(r,k){},myUploader:new FileUploader({url:'kneeCoordinate'}),confirmFun:function(data,$modalInstance){for(var i in data){if(data[i].coordinateX==0){SweetAlert.swal({title:'第'+data[i].number+"行,X值不可为0",text:'',type:"warning",confirmButtonColor:"#007AFF"});return;}
if(data[i].coordinateY==0){SweetAlert.swal({title:'第'+data[i].number+"行,Y值不可为0",text:'',type:"warning",confirmButtonColor:"#007AFF"});return;}}
$scope.kneeInputData.initialData=data;databack=angular.copy(data);setTextarea(angular.copy(data));$modalInstance.dismiss('close');}};tempModel.myUploader.onAfterAddingFile=function(fileItem){fileItem.upload();};tempModel.myUploader.onSuccessItem=function(fileItem,response,status,headers){if(!response){return;}
var arr=response.data;var newarr=angular.copy(tempModel.myData);for(var i in arr){newarr.push({coordinateX:arr[i].CoordinateX,coordinateY:arr[i].CoordinateY});}
tempModel.myData=creatNewData(newarr);};app.controller(ctrl,['$scope','$modalInstance','SweetAlert',function($scope,$modalInstance,SweetAlert){$scope.popwinmodal=tempModel;$scope.confirmBtn={confirm:function(){$scope.popwinmodal.confirmFun(angular.copy($scope.popwinmodal.myData),$modalInstance);},clear:function(){SweetAlert.swal({title:"确定要清空所有吗?",text:"",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消"},function(isConfirm){if(isConfirm){$scope.popwinmodal.myData=[{number:1,coordinateX:0,coordinateY:0},{number:2,coordinateX:0,coordinateY:0},{number:3,coordinateX:0,coordinateY:0}];}});},cancel:function(){$modalInstance.dismiss('cancel');$scope.popwinmodal.myData=angular.copy(databack);}};$scope.addtd=function(evt){if(evt.keyCode===13){var arr=angular.copy($scope.popwinmodal.myData),len=arr.length+1;arr.push({number:len,coordinateX:0,coordinateY:0});$scope.popwinmodal.myData=angular.copy(arr);}};}]);var tpl='<!-- Head -->'+'<div class="modal-header" style="padding:10px">'+'    <h4 style="margin-bottom: 0px; color: #007AFF;"><i class="fa fa-cloud-upload"/>拐点坐标</h4>'+'    <a class="my-pop-win-close" href="#" ng-click="confirmBtn.cancel()"><i class="ti-close" tooltip="关闭"></i></a>'+'</div>'+'<!-- Body -->'+'<div class="modal-body form-error">'+'    <!-- 表单 -->'+'    <div class="form-group" style="margin-bottom: 50px">'+'        <div style="margin: 0 5px">'+'            <mic-data-table tbody-height="300" table-bordered thead="序号,X,Y" td-params="{\'number\':{\'type\':\'span\',\'isclick\':true},\'coordinateX\':{\'type\':\'span\',\'isclick\':true,\'iseditnum\':true},\'coordinateY\':{\'type\':\'span\',\'isclick\':true,\'iseditnum\':true}}"'+'                        datasets="popwinmodal.myData"'+'                        table-btn-html="[{\'name\':\'插入\',\'html\':\'&lt;a  tooltip=插入 &gt;&lt;i  class=ti-plus &gt;&lt;/i&gt;&lt;/a&gt;\'},{\'name\':\'删除\',\'param\':\'isshow\',\'html\':\'&lt;a style=margin-left:13px; tooltip=删除 &gt;&lt;i  class=ti-close &gt;&lt;/i&gt;&lt;/a&gt;\'}]"'+'                        table-btn-params="popwinmodal.tabBtnParams" on-detail-click="popwinmodal.myDataClickBak(r,k)">'+'            </mic-data-table>'+'        </div>'+'    </div>'+'    <div style="position: absolute; bottom: 15px; right: 20px;">'+'        <a class="btn btn-wide btn-primary" href="javascript:;" style="min-width: 20px; float: right; margin-left: 0.5em; padding: 3px 8px;" ng-click="confirmBtn.confirm()">确定</a>'+'        <a style="min-width: 20px; float: right; margin-left: 0.5em; padding: 3px 8px;" class="btn btn-wide btn-success btn-file" href="javascript:;">'+'            导入'+'            <input type="file" nv-file-select="" uploader="popwinmodal.myUploader" />'+'        </a>'+'        <a class="btn btn-wide btn-default btn-o" href="javascript:;" style="float: right; min-width: 20px;padding: 3px 8px;" ng-click="confirmBtn.clear()">清空</a>'+'    </div>'+'</div>';$scope.ck=function(){$modal.open({template:tpl,controller:ctrl,backdrop:"static",size:'',windowClass:''});}}],replace:true,link:function(scope,element,attrs){}};});;'use strict';app.directive('openMap',['$document','abp.services.app.layerManager','SweetAlert','$timeout','$state',function($document,layerManager,SweetAlert,$timeout,$state){var loadLayer=function(map,topName,layer,ck,dataServerKey,url,tileSize,zeroLevelSize){if(!layer){layer=new iTelluro().newItelluroLayer(dataServerKey,url,tileSize,zeroLevelSize);layer.setZIndex(22);map.addLayer(layer);}
if(!ck){map.removeLayer(layer);layer=null;}
return layer;};return{restrict:'E',template:function(el,attr){var treeTpl='',gisbtn='',isShowMapTools=angular.isDefined(attr.isShowTools)?attr.isShowTools:1;if(angular.isDefined(attr.gislayerable)){treeTpl='<div class="gislayerpop hide" style="min-width:150px;border-radius:5px;overflow-y:auto;background-color:#fff;position:absolute;right:10px;top:42px;z-index:999999;border:solid 1px rgba(0, 0, 0, 0.07);"><div style="padding:15px;border-bottom:1px solid rgba(0, 0, 0, 0.07);"><h4 style="margin-bottom: 0px;" >图层设置</h4></div><abn-tree ng-if="!dataset.gisLayer===false" tree-data="dataset.gisLayer" icon-leaf="ti-empty" on-checked="onChecked" expand-level="2"></abn-tree></div>';gisbtn='              <span class="map_gislayer" tooltip="GIS图层" tooltip-append-to-body ><i class="ti-layers-alt"></i></span>';}
var tep='<div class="map_container">'+treeTpl+'      <div class="mapDiv"></div> '+'      <div class="mapDivBtn"> '+'              <span ng-click="changeMap(true)">地图</span>'+'              <span ng-click="changeMap(false)">卫星</span>'+'       </div>'+'      <div class="mapControllerBtn" > '+
gisbtn+'              <span class="map_length" tooltip="测量距离" tooltip-append-to-body ng-click="measuremap(\'line\',\'map_length\')"><i class="ti-ruler"></i></span>'+'              <span class="map_area"   tooltip="测量面积" tooltip-append-to-body ng-click="measuremap(\'area\',\'map_area\')"><i class="ti-ruler-alt-2"></i></span>'+'              <span class="map_reset"  tooltip="复位" tooltip-append-to-body ng-click="reset(\'map_reset\')"><i class="ti-back-right"></i></span>'+'              <span class="map_clear"  tooltip="清理图层" tooltip-append-to-body ng-click="clearMap(\'map_clear\')"><i class="ti-trash"></i></span>'+'              <span class="map_fullScreen" tooltip="全屏" tooltip-append-to-body ng-click="clickFull()"><i class="ti-fullscreen"></i></span>'+'       </div>'+' <div class="ol-unselectable ol-control"><a class="ol-zoom-in map-zoom-in"><i class="ti-plus"/></a><a tooltip-placement="bottom" class="ol-zoom-out map-zoom-out"><i class="ti-minus"/></a></div>'+'</div>'
return tep;},replace:true,scope:{dataset:"=?",mapheight:"=?",measuremap:'=?',clearDraw:'=?',getExtent:'=?',addTagging:'=?',addChart:'=?',addMarker:'=?',addLocation:'=?',addLayer:'=?',removeLayer:'=?',isShowTools:'=?',isLine:'=?',isArea:'=?',isReset:'=?',isClear:'=?',isFullscreen:'=?',isZoominorout:'=?',isLoadInternetTianDiTu:'=?',onDrawstart:'=?',onDrawend:'=?',},link:function(scope,element,attr){var map,vector=new ol.layer.Vector(),topName,chkId,select,dragBox,selectedFeatures,MeasureTool,isAgain=false,vectorLayer,lyr={},typeSelect={},vectorSource,locationLayer;var baseMap_map=scope.dataset?scope.dataset.baseMap.map:{};var baseMap_note=scope.dataset?scope.dataset.baseMap.note:{};var statellite_map=scope.dataset?scope.dataset.statelliteMap.map:{};var statellite_note=scope.dataset?scope.dataset.statelliteMap.note:{};var mapheight=angular.isUndefined(scope.mapheight)?550:scope.mapheight;scope.addLayer=function(layer,bounds){if(map===undefined){return scope.addLayer(layer,bounds);}
map.addLayer(layer);if(bounds&&bounds.length===4){map.getView().fit(bounds,map.getSize());}
return map;};scope.removeLayer=function(layer){map.removeLayer(layer);};typeSelect.check=false;scope.isAgain=false;var mapDiv=element.find("div.mapDiv");mapDiv.css({height:mapheight});var tree=element.find("div.gislayerpop");tree.css({maxHeight:scope.mapheight-50});function loadMap(){if(map!=undefined){var layers=map.getLayers().array_;angular.forEach(layers,function(e){map.removeLayer(e);});};var zjLayer;if(!!scope.isLoadInternetTianDiTu){map=new TianDiTu().NewWebTilesMap(mapDiv[0],20,180,-180,-90,90,'vec_c','http://t0.tianditu.com/DataServer',256,36,'baseLayer');zjLayer=new TianDiTu().newWebVectorLabelLayer(null,'zjLayer');}else{map=NewWebTilesMap(mapDiv[0],baseMap_map.zoomlevel,180,-180,-90,90,baseMap_map.dataserverkey,baseMap_map.url,baseMap_map.tilesize,baseMap_map.zerolevelsize,'baseLayer');zjLayer=new iTelluro().newItelluroLayer(baseMap_note.dataserverkey,baseMap_note.url,baseMap_note.tilesize,baseMap_note.zerolevelsize,'zjLayer');}
zjLayer.setZIndex(18);map.addLayer(zjLayer);changeColor(0,1);initMap();};if(!scope.dataset){layerManager.getAllList().success(function(data){if(!data){return;}
scope.dataset=data;baseMap_map=scope.dataset.baseMap.map;baseMap_note=scope.dataset.baseMap.note;statellite_map=scope.dataset.statelliteMap.map;statellite_note=scope.dataset.statelliteMap.note;loadMap();}).error(function(){SweetAlert.swal({title:"读取地图数据失败！",text:"",type:"error",confirmButtonColor:"#007AFF"});});}else{loadMap();};function initMap(){map.getView().setCenter([94,30]);map.addControl(new ol.control.MousePosition({className:'map_mouse-position',undefinedHTML:'',projection:'EPSG:4326',coordinateFormat:function(coordinate){return ol.coordinate.format(coordinate,'{x}, {y}',4);}}));map.addControl(new ol.control.FullScreen({element:element.find("span.map_fullScreen")[0],exitFullScreenBackFun:function(){mapDiv.css({height:scope.mapheight});}}));if(scope.isZoominorout){map.addControl(new ol.control.Zoom({element:{zoomIn:element.find("a.map-zoom-in")[0],zoomOut:element.find("a.map-zoom-out")[0]}}));}
map.addControl(new ol.control.ScaleLine());MeasureTool=new ol.control.MeasureTool();MeasureTool.vector.setZIndex(30);map.addLayer(MeasureTool.vector);map.addControl(MeasureTool);};scope.changeMap=function(flag){if(flag){changeColor(0,1);setLayer(baseMap_map,baseMap_note);}else{changeColor(1,0);setLayer(statellite_map,statellite_note);}};function setLayer(mapdata,notedata){var newBaseLayer,newZjLayer;removeAllLayer({base:"baseLayer",zj:"zjLayer"});if(!!scope.isLoadInternetTianDiTu){newBaseLayer=new TianDiTu().newWebImageLayer(null,'baseLayer');newZjLayer=new TianDiTu().newWebImageLabelLayer(null,'zjLayer');}else{newBaseLayer=new iTelluro().newItelluroLayer(mapdata.dataserverkey,mapdata.url,mapdata.tilesize,mapdata.zerolevelsize,'baseLayer');newZjLayer=new iTelluro().newItelluroLayer(notedata.dataserverkey,notedata.url,notedata.tilesize,notedata.zerolevelsize,'zjLayer');}
newBaseLayer.setZIndex(0);map.addLayer(newBaseLayer);newZjLayer.setZIndex(18);map.addLayer(newZjLayer);};function removeAllLayer(obj){var arr=map.getLayers().array_;var len=arr.length;for(var i=0;i<len;i++){if(!arr[i]){return;}
if(arr[i].get("name")===obj.base||arr[i].get("name")===obj.zj)
map.removeLayer(arr[i]);}};scope.addMarker=function(markerArr){var features=[];var url=markerArr[0].url;var markerLayer=new ol.layer.Vector({source:new ol.source.Vector()});var style=new ol.style.Style({image:new ol.style.Icon({src:url,anchor:[1,1]})});angular.forEach(markerArr,function(data,index){var feature=new ol.Feature({geometry:new ol.geom.Point(data.location)});feature.obj={"id":index};feature.setStyle(style);features.push(feature);markerLayer.getSource().addFeature(feature);markerLayer.setZIndex(20);});map.addLayer(markerLayer);};scope.addLocation=function(locationArr){removeMarker();var style=new ol.style.Style({image:new ol.style.Icon({src:locationArr[0].url,anchor:[1,1]})});var feature=new ol.Feature({geometry:new ol.geom.Point([locationArr[0].longitude,locationArr[0].latitude]),});feature.setStyle(style);locationLayer=new ol.layer.Vector({source:new ol.source.Vector()});locationLayer.getSource().addFeature(feature);locationLayer.setZIndex(20);map.addLayer(locationLayer);map.getView().setCenter([locationArr[0].longitude,locationArr[0].latitude]);};map.on("click",function(evt){var pixel=map.getEventPixel(evt.originalEvent);var feature=map.forEachFeatureAtPixel(pixel,function(feature){return feature;});var coordinate=evt.coordinate;if(feature&&feature.obj){var popupElement='<div class="popup" style="width:300px;height:300px;background:#fff;border-radius:10px;position:relative;top:20px;left:10px;">'+'    <div  class="popup-header" style="display:flex;height:40px;line-height:40px;padding:10px 0 20px 10px;border-bottom:1px solid #E5E5E5;"><h3 style="font-size:15px;width:90%;height:100%;">灾害点信息</h3><a href="#" style="width:10%;height:30px;line-height:30px;display:block;text-align:center;" class="ol-popup-closer"><i class="ti-close" tooltip="关闭"></i></a></div>'+'    <div class="popup-content" style="margin:10px 0 0 0;">'+'        <div style="border-bottom:1px solid #E5E5E5;width:90%;height:40px;line-height:40px;margin:5px auto;"><span>监测设备名称 :</span><span>栖霞翠屏街道黄燕底崩塌隐患</span></div>'+'        <div style="border-bottom:1px solid #E5E5E5;width:90%;height:40px;line-height:40px;margin:5px auto;"><span>监测设备编号 :</span><span>'+feature.obj.id+'</span></div>'+'        <div style="border-bottom:1px solid #E5E5E5;width:90%;height:40px;line-height:40px;margin:5px auto;"><span>经度:</span><span>120.87255556</span></div>'+'        <div style="border-bottom:1px solid #E5E5E5;width:90%;height:40px;line-height:40px;margin:5px auto;"><span>纬度:</span><span>37.26122222</span></div>'+'    </div>'+'   <div class="disInfo" style="width:40%;height:30px;line-height:30px;text-align:center;margin:10px 0 0 20px;border:1px solid #E5E5E5;"><a  href="javascript:void(0)" style="text-decoration: none;" class="popup-info">灾害点详细信息</a></div>'+'</div>';var popup_element=angular.element(popupElement)[0];var info_popup=new ol.Overlay(({element:popup_element,autoPan:true,autoPanAnimation:{duration:250}}));map.addOverlay(info_popup);info_popup.setPosition(coordinate);angular.element(".popup").find(".ol-popup-closer").on('click',function(evt){evt.preventDefault();info_popup.setPosition(undefined);});angular.element(".popup").find(".popup-info").on('click',function(evt){$state.go("appPages.secondDetail.page",{});});}else{return;}});function removeAllOverlay(map){map.getOverlays().getArray().slice(0).forEach(function(overlay){map.removeOverlay(overlay);})};function removeMarker(){if(locationLayer){locationLayer.getSource().clear(locationLayer.getSource().getFeatures());}};scope.addChart=function(option,position){removeAllOverlay(map);var chartHtmlTemplate='<div class="popup" style="width:400px;height:300px;background:#fff;border-radius:10px;padding:10px;box-shdow:10px 5px #eee;">'+'<div style="position:absolute;top:-20px;left:-20px;width:0px;height:0px;border:20px solid transparent;border-bottom-color:red;transform:rotate(-45deg);"></div>'+'    <div id="popupContent" style="width:400px;height:300px;">'+'    </div>'+'</div>';var popup_element=angular.element(chartHtmlTemplate);var popupContent=popup_element.find('#popupContent');var myChart=echarts.init(popupContent[0]);var chartPopup=new ol.Overlay(({element:popup_element[0],autoPan:true,positioning:'top-left',autoPanAnimation:{duration:250}}));chartPopup.setPosition(position);map.addOverlay(chartPopup);var chartOption={};for(var key in option){chartOption[key]=option[key];}
myChart.setOption(chartOption);};for(var i in lyr){if(!lyr[i]){continue;}
if(chkId!==i){map.addLayer(lyr[i]);}}
if(lyr[chkId]){map.addLayer(lyr[chkId]);}
scope.onChecked=function(node){if(!node.isLeaf){recursions(node.children);}else{chkId=node.uid;lyr[node.uid]=loadLayer(map,topName,lyr[node.uid],node.checked,node.dataserverkey,node.url,node.tilesize,node.zerolevelsize);}};function recursions(arr){for(var i in arr){if(!arr[i].isLeaf){recursions(arr[i].children);}else{chkId=arr[i].uid;lyr[arr[i].uid]=loadLayer(map,topName,lyr[arr[i].uid],arr[i].checked,arr[i].dataserverkey,arr[i].url,arr[i].tilesize,arr[i].zerolevelsize);}}};scope.measuremap=function(measure,className){if(scope.onDrawstart){scope.onDrawstart();}
typeSelect.value=measure;MeasureTool.mapmeasure(typeSelect,null,function(){scope.getExtent=MeasureTool.getExtent;if(scope.onDrawend){scope.onDrawend(scope.getExtent);}});if(!className)return;currentState(className);};function clearMeasureVector(){var maplayers=map.getLayers().array_;angular.forEach(maplayers,function(obj){if(obj.getZIndex()===30){obj.getSource().clear();}});};scope.clearDraw=function(){removeAllOverlay(map);removeMarker();clearMeasureVector();};function changeColor(index0,index1){element.find(".mapDivBtn").find("span").eq(index0).addClass("map_active");element.find(".mapDivBtn").find("span").eq(index1).removeClass("map_active");}
function currentState(className){var spanobj=element.find("div.mapControllerBtn").find("span."+className);element.find("div.mapControllerBtn").find("span").css("background","#fff");element.find("div.mapControllerBtn").find("span").find("i").css("color","#007AFF");spanobj.css("background","#007AFF");spanobj.find("i").css("color","#fff");}
scope.clearMap=function(className){currentState(className);removeAllOverlay(map);removeMarker();clearMeasureVector();}
scope.reset=function(cls){map.getView().setCenter([94,30]);currentState(cls);};scope.clickFull=function(){scope.mapheight=element.find("div.mapDiv")[0].offsetHeight;mapDiv.css({height:'100%'});};scope.addTagging=function(type,coordinates){map.removeLayer(vectorLayer);var geometry;if(type==='MultiPolygon'){coordinates=[[coordinates]];geometry=new ol.geom.MultiPolygon(coordinates);}else if(type==='Point'){geometry=new ol.geom.Point(coordinates);}else{return;}
vectorSource=new ol.source.Vector({});vectorLayer=new ol.layer.Vector({source:vectorSource});map.addLayer(vectorLayer);var iconFeature=new ol.Feature({geometry:geometry,name:'拐点坐标标注',population:4000,rainfall:500}),iconStyle=new ol.style.Style({fill:new ol.style.Fill({color:'rgba(252, 216, 107, 0.35)'}),stroke:new ol.style.Stroke({color:'#ffcc33',width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:'#ffcc33'})})});iconFeature.setStyle(iconStyle);vectorSource.addFeature(iconFeature);};var isAncestorOrSelf=function(element,target){var parent=element;while(parent.length>0){if(parent[0]===target[0]){return true;}
parent=parent.parent();}
return false;};var closeOnOuterClicks=function(e){var elem=element.find('div.gislayerpop');if(angular.element(e.target).hasClass('map_gislayer')||angular.element(e.target).parent().hasClass('map_gislayer')){elem.removeClass('hide');currentState('map_gislayer');return;}
if(!isAncestorOrSelf(angular.element(e.target),elem)){elem.addClass('hide');}};if(angular.isDefined(attr.gislayerable)){$document.on('click',closeOnOuterClicks);}
scope.$on('$destroy',function(){$document.off('click',closeOnOuterClicks);});}};}]);;'use strict';app.service('waitmask',function(){this.onShowMask=function(msg,width){var str="width:"+width+"px";var templates='<div id="mic_mask">'+'<div class="mask_all"></div>'+'<div class="mic-progressbar" style="'+str+'">'+'<div class="mic-spinner">'+'<div class="loading-bar opacity-0">'+'<div class="loading-point" style="transform: rotate(0deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-1">'+'<div class="loading-point" style="transform: rotate(32deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-2">'+'<div class="loading-point" style="transform: rotate(65deg) translate(7px, 0px); ">'+'</div>'+'</div>'+'<div class="loading-bar opacity-3">'+'<div class="loading-point" style="transform: rotate(98deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-4">'+'<div class="loading-point" style="transform: rotate(130deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-5">'+'<div class="loading-point" style="transform: rotate(163deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-6">'+'<div class="loading-point" style="transform: rotate(196deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-7">'+'<div class="loading-point" style="transform: rotate(229deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-8">'+'<div class="loading-point" style="transform: rotate(261deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-9">'+'<div class="loading-point" style="transform: rotate(294deg) translate(7px, 0px);">'+'</div>'+'</div>'+'<div class="loading-bar opacity-10">'+'<div class="loading-point" style="transform: rotate(327deg) translate(7px, 0px);">'+'</div>'+'</div>'+'</div>'+'<div style="position: absolute; top: 32%; left: 40%; color: #fff">'+'{{message}}'+'</div>'+'</div></div>';if(!!msg){templates=templates.replace('{{message}}',msg);}
else{templates=templates.replace('{{message}}',"正在加载");}
$("#app").prepend(templates);}
this.onHideMask=function(){$("#mic_mask").remove();}});;'use strict';app.directive('messageItem',['$location',function($location){return{restrict:'EA',link:function(scope,elem,attrs){elem.on("click tap",function(e){var id=attrs.messageItem;});}};}]);;'use strict';app.directive('multimedia',function($timeout){return{restrict:'E',template:function(elemt,attr){var a='',b='';if(angular.isDefined(attr.editTypeAble)){a='<a ng-click="addMediaType($event)" href="javascript:;" style="position: absolute; top: 30%; right: 15px;" tooltip="添加列表" tooltip-append-to-body>'+'   <i class="fa ti-plus fontsize16"></i>'+'</a>',b='<input type="text" ng-model="row.name" ng-class="{\'html-not-show\':!row.isShowInput}" ng-keyup="keydownInput(row, $event)" ng-blur="row.isEdit=false;blurInput(row, $event)" />'+'<i class="ti-close" ng-class="row.children.length>0?\' ti-dis\':\'\'" ng-click="delete(row,$event)" tooltip="删除" tooltip-refer-class="div.multimedia-list>div.panel-group" tooltip-append-to-body></i>'+'<i class="edit-media ti-pencil" ng-class="{\'html-not-show\':row.isEdit}" ng-click="row.isEdit=true;row.isShowInput=true;editMediaType(row, $event)" tooltip="修改" tooltip-append-to-body tooltip-refer-class="div.multimedia-list>div.panel-group"></i>'+'<i class="edit-media ti-pencil" ng-class="{\'html-not-show\':!row.isEdit,\' ti-dis\':row.isShowInput}" tooltip="修改" tooltip-refer-class="div.multimedia-list>div.panel-group"></i>';}
var templates='<div>'+'<div class="multmedia-left">'+'    <div style="padding-bottom: 10px;border-bottom: solid 1px rgba(33,33,33,0.2)">'+'        <div style="margin: 5px; background-color: rgb(240,243,243); height: 40px; position: relative">'+'            <h4 style="font-size: 14px; font-weight: 600; padding-top: 12px; padding-left: 15px;">多媒体列表</h4>'+
a+'        </div>'+'        <div style="text-align:center; margin-top: 10px;">'+'            <a ng-init="hideUploadBtn=true" ng-disabled="hideUploadBtn||useReadonly" class="btn btn-wide btn-o btn-primary btn-file" href="javascript:;">'+'                <i class="fa ti-upload"></i>&nbsp;上传'+'                <input type="file" nv-file-select="" uploader="myUploader" filters="customsFilter" multiple />'+'            </a>'+'            <a ng-init="hideDelBtn=true" ng-disabled="hideDelBtn||useReadonly" ng-click="deleteMedia()" class="btn btn-wide btn-o btn-danger" href="javascript:;">'+'                <i class="fa ti-na"></i>&nbsp;删除'+'            </a>'+'        </div>'+'    </div>'+'    <div class="multimedia-list">'+'        <div class="panel-group">'+'            <div ng-repeat="row in multimediaData" class="panel panel-default ng-isolate-scope">'+'                <div class="panel-heading" ng-class="{\'active\':row.actived}">'+'                    <h4 class="panel-title" style="font-weight: 400;">'+'                        <a href class="a-toggle" ng-click="row.isopen=!row.isopen;toggleOpen(row)"><span>{{row.name}}</span></a>'+
b+'                    </h4>'+'                </div>'+'                <div class="panel-collapse" collapse="!row.isopen">'+'                    <ul class="nav nav-list nav-pills nav-stacked ng-isolate-scope ">'+'                        <li ng-repeat="media in row.children">'+'                            <a ng-class="{\'active\':media.selected}" ng-click="showMedia(media)">{{media.physicalName}}</a>'+'                        </li>'+'                    </ul>'+'                </div>'+'            </div>'+'        </div>'+'    </div>'+'</div>'+'<div class="multmedia-right">'+'    <div class="panel-heading border-light">'+'        <h4 class="panel-title">多媒体文档</h4>'+'        <ul class="panel-heading-tabs border-light">'+'            <li class="panel-tools">'+'                <div class="slider_father" tabindex="0" style="width: 55px; height: 160px; position: absolute; top: 50px; left: -4px; outline: none; background-color:#fff;" ng-mouseleave="slider_mouseleave()" ng-class="{\'hide\':show_slider}">'+'                </div>'+'                <a href="javascript:void(0)" ng-click="big()" ng-class="{\'ti-dis\':isNotImg}" tooltip="缩放">'+'                    <i class="ti-search fontsize16"></i>'+'                </a>'+'            </li>'+'            <li class="panel-tools">'+'                <a ng-click="downlink()" ng-class="{\'ti-dis\':isEmpty}" download tooltip="下载">'+'                    <i class="ti-download fontsize16"></i>'+'                </a>'+'            </li>'+'        </ul>'+'    </div>'+'    <div class="media_contents" style="height: 398px; overflow: auto"></div>'+'</div>'+'</div>';return templates;},scope:{fkey:'=',moduleType:'=',useReadonly:'=?'},controller:['$scope','$element','FileUploader','SweetAlert','abp.services.app.attachment','abp.services.app.multimedia','$sce','$http',function($scope,$element,FileUploader,SweetAlert,attachment,multimedia,$sce,$http){$scope.useReadonly=angular.isUndefined($scope.useReadonly)?false:$scope.useReadonly;var selected_media,actived_mediaTpye,rowNameOld;function getlistDate(FKey,ModuleType){if(!FKey||!ModuleType){return;}
multimedia.getAllList({FKey:FKey,ModuleType:ModuleType}).success(function(data,status){$scope.multimediaData=data;}).error(function(data,status){});}
var watch=$scope.$watch(function(){return $scope.fkey+$scope.moduleType;},function(newValue,oldValue,scope){getlistDate($scope.fkey,$scope.moduleType);});$scope.myUploader=new FileUploader();$scope.myUploader.filters.push({name:'customsFilter',fn:function(item){return true;}});$scope.myUploader.onAfterAddingFile=function(fileItem){fileItem.upload();};$scope.myUploader.onSuccessItem=function(fileItem,response,status,headers){if(response.success==="true"){var a=angular.copy($scope.multimediaData);for(var i in a){if(a[i].id===response.data.typeCode)
$scope.multimediaData[i].children.push(response.data);}
SweetAlert.swal({title:"上传成功！",text:"",type:"success",confirmButtonColor:"#007AFF"});}
else{SweetAlert.swal({title:"上传失败！",text:response.message,type:"error",confirmButtonColor:"#007AFF"});}};$scope.addMediaType=function($event){rowNameOld='';var dt=angular.copy($scope.multimediaData);var bo=false;for(var i in dt){if(dt[i].id===null)
bo=true;}
if(bo){return;}
$scope.multimediaData.push({id:null,name:null,moduleType:ModuleType,children:[],isShowInput:true,isEdit:true});$timeout(function(){angular.element($event.target).parent().parent().parent().next().find('input').last().select();});};$scope.editMediaType=function(row,$event){rowNameOld=row.name;$timeout(function(){angular.element($event.target).parent().children('input').select();},20);};$scope.keydownInput=function(row,$event){if($event.keyCode===13)
$scope.blurInput(row,$event);};$scope.blurInput=function(row,$event){row.isShowInput=false;row.isSaved=false;if(!row.name){SweetAlert.swal({title:"提示：列表名称不能为空！",text:"确定放弃编辑该项吗?",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"是",cancelButtonText:"否"},function(isConfirm){if(isConfirm){row.isEdit=false;if(row.id===null)
deldt(row);}else{row.isEdit=true;row.isShowInput=true;$timeout(function(){angular.element($event.target).select();},20);}
row.name=rowNameOld;});return;}
if(row.name===rowNameOld){return;}
saveMediaType(row,$event);};var saveMediaType=function(row,$event){if(!row.id){multimedia.insert(row).success(function(data,status){if(data){for(var j in $scope.multimediaData){if($scope.multimediaData[j].id===null)
$scope.multimediaData[j].id=data;}}}).error(function(data,status){});}else{multimedia.update(row).success(function(data,status){}).error(function(data,status){});}};function deldt(dt){var d=angular.copy($scope.multimediaData);for(var i=0;i<d.length;i++){if(d[i].id===dt.id)
$scope.multimediaData.splice(i,1);}}
$scope.delete=function(row,$event){if(angular.element($event.target).hasClass('ti-dis')){SweetAlert.swal({title:"该目录下存在多媒体文件！",text:"请先删除这些文件后再删除该目录。",type:"warning",confirmButtonColor:"#007AFF"});return;}
SweetAlert.swal({title:"确定要删除该目录吗?",text:"",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消"},function(isConfirm){if(isConfirm){if(row.id===null){deldt(row);return;}
multimedia.delete(row.id).success(function(data,status){if(data){deldt(row);}else{SweetAlert.swal({title:"该目录下存在多媒体文件！",text:"请先删除这些文件后再删除该目录。",type:"warning",confirmButtonColor:"#007AFF"});}}).error(function(data,status){});}});}
$scope.toggleOpen=function(row){if(row.id===null){return;}
if(row!==actived_mediaTpye){if(actived_mediaTpye!=null){actived_mediaTpye.actived=false;}
row.actived=true;actived_mediaTpye=row;$scope.hideUploadBtn=false;$scope.myUploader.url='multimediaupload?fkey='+$scope.fkey+'&typecode='+actived_mediaTpye.id;}};$scope.deleteMedia=function(){SweetAlert.swal({title:"确定要删除吗?",text:"",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消"},function(isConfirm){if(isConfirm){if(!selected_media){return;}
attachment.delete(selected_media.id).success(function(data,status){if(data){var m=angular.copy($scope.multimediaData);for(var o in m){if(m[o].id===selected_media.typeCode){for(var p=0;p<m[o].children.length;p++){if(m[o].children[p].id===selected_media.id){$scope.multimediaData[o].children.splice(p,1);break;}}
break;}}
selected_media=null;$scope.hideDelBtn=true;SweetAlert.swal({title:"多媒体删除成功！",text:"",type:"success",confirmButtonColor:"#007AFF"});differType('');}}).error(function(data,status){});}});};$scope.showMedia=function(media){$scope.hideDelBtn=false;if(media!==selected_media){if(selected_media!=null){selected_media.selected=false;}
media.selected=true;selected_media=media;differType(selected_media);}};$scope.isNotImg=true;$scope.isEmpty=true;$scope.show_slider=true;function createBlob(data,contentType){if(typeof Blob!=='undefined'){return new Blob([data],{type:contentType});}
var bb=new MozBlobBuilder();bb.append(data);return bb.getBlob(contentType);}
function fileDown(url,name){$http.get(url,{responseType:'arraybuffer'}).success(function(data){var blob=createBlob(data,'application/*');if(navigator.msSaveBlob){if(navigator.msSaveBlob(blob,name)){return;}}
var fileUrl=URL.createObjectURL(blob);var a=document.createElement('a');a.href=fileUrl;a.target='_blank';a.download=name;document.body.appendChild(a);a.click();a.parentNode.removeChild(a);});};var mediaEl=$element.find('div.media_contents'),sliderEl=$element.find('div.slider_father');function differType(obj){console.log(obj);console.log($scope.hideUploadBtn);mediaEl.empty();sliderEl.empty();$scope.isNotImg=true;$scope.isEmpty=true;$scope.show_slider=true;if(obj==null){}
else{var tempUrl=obj.httpPath.split(".");var type=obj.extension;var html="";var reUrl="";if(type===".png"||type===".jpg"||type===".bmp"||type===".PNG"||type===".JPG"||type===".BMP"){$scope.isNotImg=false;reUrl=$sce.trustAsResourceUrl(obj.httpPath);html='<img src="" alt="这是一张图片，但是它丢了" />';var sliderHtml='<div class="slider_forimg">'+'    <span class="slider_title">100.0%</span>'+'    <div class="slider_scale">'+'        <div></div>'+'        <span class="slider_btn"></span>'+'    </div>'+'</div>';sliderEl.append(sliderHtml);}
else if(type===".mp4"||type===".webm"||type===".ogg"||type===".MP4"||type===".WEBM"||type===".OGG"){reUrl=$sce.trustAsResourceUrl(obj.httpPath);html="<video width=\"500\" height=\"398\" preload=\"auto\" controls>"+"    <source src=\""+reUrl+"\" type=\"video/mp4\" />"+"    <source src=\""+reUrl+"\" type=\"video/webm\" />"+"    <source src=\""+reUrl+"\" type=\"video/ogg\" />"+"</video>";}
else if(type===".wmv"||type===".wma"||type===".avi"||type===".rmvb"||type===".mpeg"||type===".flv"||type===".f4v"||type===".WMV"||type===".WMA"||type===".AVI"||type===".RMVB"||type===".MPEG"||type===".FLV"||type===".F4V"){reUrl=$sce.trustAsResourceUrl(obj.httpPath);html="<object classid=\"clsid:22D6F312-B0F6-11D0-94AB-0080C74C7E95\" height=\"398\" width=\"500\">"+"        <param name=\"filename\" value=\""+reUrl+"\" />"+"        <param name\"wmode\" value=\"opaque\" />"+"        <param name=\"quality\" value=\"high\" />"+"    <embed src=\""+reUrl+"\" height=\"398\" width=\"500\" quality=\"high\" allowscriptaccess=\"sameDomain\"></embed>"+"</object>";}
else if(type===".mp3"||type===".wav"||type===".MP3"||type===".WAV"){reUrl=$sce.trustAsResourceUrl(obj.httpPath);html="<audio preload=\"auto\" controls>"+"    <source src=\""+reUrl+"\" type=\"audio/mp3\" />"+"    <source src=\""+reUrl+"\" type=\"audio/wav\" />"+"</audio>";}
else if(type===".pdf"||type===".PDF"){reUrl="PDFJSInNet/web/viewer.html?file="+$sce.trustAsResourceUrl(obj.httpPath);html="<iframe src=\""+reUrl+"\" frameborder=\"0\" scrolling=\"yes\" style=\"width: 100%; height: 394px\"></iframe>";}
else if(type===".doc"||type===".xls"||type===".ppt"||type===".docx"||type===".xlsx"||type===".pptx"){var tempOfficeUrl=tempUrl.slice(1,-1);var tempOfficeUrl1=tempOfficeUrl.join('.')+".pdf";console.log(tempOfficeUrl1);reUrl="PDFJSInNet/web/viewer.html?file="+$sce.trustAsResourceUrl(tempOfficeUrl1);html="<iframe src=\""+reUrl+"\" frameborder=\"0\" scrolling=\"yes\" style=\"width: 100%; height: 394px\"></iframe>";}
else{var size="";if(obj.fileSize<1000){size=obj.fileSize+"B";}
else if(obj.fileSize/1024<1000){size=(obj.fileSize/1024).toFixed(2)+"KB";}
else if(obj.fileSize/1024/1024<1000){size=(obj.fileSize/1024/1024).toFixed(2)+"MB";}
else{size=(obj.fileSize/1024/1024/1024).toFixed(2)+"GB";}
html="<span>文件名："+obj.physicalName+"</span>"+"<br />"+"<br />"+"<span>文件大小："+size+"</span>"+"<br />"+"<br />"+"<span>无法预览该类型文件！</span>"}
mediaEl.append(html);if(type===".png"||type===".jpg"||type===".bmp"||type===".PNG"||type===".JPG"||type===".BMP"){var elimg=$element.find('div.media_contents img');elimg.load(function(){$scope.imgHeight=elimg[0].height;});elimg[0].src=reUrl;}
$scope.downlink=function(){fileDown(obj.httpPath,obj.logicName);};$scope.isEmpty=false;}
return reUrl;}
$scope.big=function(){if(!$scope.isNotImg){new scale();$scope.show_slider=!$scope.show_slider;}}
$scope.slider_mouseleave=function(){$scope.show_slider=true;}
var scale=function(){this.btn=$element.find('span.slider_btn');this.bar=$element.find('div.slider_scale');this.title=$element.find('span.slider_title');this.step=this.bar.find('div');this.img=$element.find('div.media_contents img');this.init();};scale.prototype={init:function(){var f=this,g=document,b=window,m=Math;f.btn.mousedown(function(e){var y=(e||b.event).clientY;var l=this.offsetTop;var max=f.bar[0].offsetHeight-this.offsetHeight;g.onmousemove=function(e){var thisY=(e||b.event).clientY;var to=m.min(max,m.max(0,l+(thisY-y)));f.btn.css('top',to+'px');f.ondrag(m.round(m.max(0,to/max)*100),to);b.getSelection?b.getSelection().removeAllRanges():g.selection.empty();};g.onmouseup=new Function('this.onmousemove=null');});},ondrag:function(pos,x){this.step.css('height',Math.max(0,x)+(pos===0?0:1)+'px');this.title.html((20+3.8*(100-pos)).toFixed(1)+'%');this.img.css('height',$scope.imgHeight*((20+3.8*(100-pos))/100)+'px');}}}],transclude:true,replace:true}});;'use strict';app.directive('mutiTextbox',function($timeout){return{restrict:'E',template:function(elem,attr){var templates="";if(!angular.isUndefined(attr.textTitle)){templates='<div class="form-horizontal">'+'    <div class="form-group">'+'        <label class="col-sm-2 control-label" ng-class="{\'muti-not-show\':textUp}">'+'            {{textTitle}}'+'        </label>'+'        <div ng-class="{\'col-sm-12\':textUp, \'col-sm-10\':!textUp}">'+'            <label class="col-sm-12 up-label" ng-class="{\'muti-not-show\':!textUp}">'+'                {{textTitle}}'+'            </label>'+'            <textarea class="form-control" placeholder="{{textPlaceholder}}" ng-model="textModel"></textarea>'+'        </div>'+'    </div>'+'</div>';}
else{templates='<div class="form-horizontal">'+'    <div class="form-group">'+'        <div class="col-sm-12">'+'            <textarea class="form-control" placeholder="{{textPlaceholder}}" ng-model="textModel"></textarea>'+'        </div>'+'    </div>'+'</div>';}
return templates;},scope:{textUp:'=?',textPlaceholder:'=?',textModel:'=?',textTitle:'=?'},link:function(scope,elem,attr){scope.textPlaceholder=angular.isUndefined(scope.textPlaceholder)?'请输入...':scope.textPlaceholder;scope.textModel=angular.isUndefined(scope.textModel)?'':scope.textModel;scope.textUp=angular.isUndefined(scope.textUp)?false:scope.textUp;if(!angular.isUndefined(attr.textTitle)){if(attr.textTitle===""||attr.textTitle===null){scope.textTitle="多行文本框";}}},transclude:true,replace:true}});;'use strict';app.directive('notifiBtn',function($timeout){return{restrict:'E',template:function(){var templates='<a class="notifications" href="javascript:;" ng-click="onNotiClick()" ng-init="isShowNum = true">'+'<span style="position: absolute; margin-left: 65px\\0;" ng-class="{\'partition-red\':isShowNum,\'notifications-num\':isShowNum}">{{ showModel }}</span> '+'<i class="ti-comment"></i> '+'<span>{{message}}</span>'+'</a>';return templates;},scope:{notiModel:'=?',onNotiClick:'=?',message:'=?',isHidden:'=?'},link:function(scope,elem,attr,ctrl){scope.notiModel=angular.isUndefined(scope.notiModel)?'':scope.notiModel;scope.isHidden=angular.isUndefined(scope.isHidden)?true:scope.isHidden;scope.showModel="";if(scope.notiModel){scope.showModel=scope.notiModel;if(parseInt(scope.notiModel)>99){scope.showModel="99+";}
if(parseInt(scope.notiModel)<1){scope.showModel="";}}
scope.$watch('notiModel',function(newValue,oldValue){if(newValue!==oldValue){scope.showModel=scope.notiModel;if(parseInt(scope.notiModel)>99){scope.showModel="99+";}
if(parseInt(scope.notiModel)<1){scope.showModel="";}}})
elem.children("a").bind("click",function(){if(scope.isHidden){$timeout(function(){scope.isShowNum=false;scope.notiModel='';scope.showModel='';},0);}});},replace:false}});app.directive('notifiRow',function($timeout){return{restrict:'E',template:function(){var templates='<div class="list-group-item notification-list">'+'<a href="javascript:;" ng-click="onNotiClick()">'+'{{message}} '+'<span class="badge">{{notiModel}}</span>'+'</a>'+'</div>';return templates;},scope:{notiModel:'=?',onNotiClick:'=?',message:'=?',isHidden:'=?'},link:function(scope,elem,attr,ctrl){scope.notiModel=angular.isUndefined(scope.notiModel)?'':scope.notiModel;scope.isHidden=angular.isUndefined(scope.isHidden)?true:scope.isHidden;elem.children().children("a").bind("click",function(){if(scope.isHidden){$timeout(function(){scope.notiModel='';},0);}});},replace:false}});;'use strict';app.directive('numBox',function($timeout){return{restrict:'E',template:function(elem,attr){var templates="";if(angular.isUndefined(attr.textTitle)){templates='<input type="text" class="form-control" placeholder="{{textPlaceholder}}" '+'ng-model="textModel" >';}
else{templates='<div class="input-group bootstrap-touchspin">'+'<label class="control-label" style="display: table-cell; vertical-align: middle; padding-right: 30px">'+'{{textTitle}}'+'</label>'+'<input type="text" class="form-control" placeholder="{{textPlaceholder}}" '+'ng-model="textModel" '+' >'+'<a class="input-cancel" style="right: 32px; top: 7px" href="javascript:;"><i class="fa fa-times" style="color: gray" ng-click="cleanInput()"></i></a>'+'<span class="input-group-btn-vertical" style="width:auto" ng-show="{{showButton}}">'+'<a class="btn btn-default bootstrap-touchspin-up no-radius" ng-click="numup()">'+'<i class="glyphicon glyphicon-chevron-up"></i>'+'</a>'+'<a class="btn btn-default bootstrap-touchspin-down no-radius">'+'<i class="glyphicon glyphicon-chevron-down" ng-click="numdown()"></i>'+'</a>'+'</span>'+'</div>';}
return templates;},scope:{textModel:'=?',showButton:'=?',step:'=?',precision:'=?'},link:function(scope,elem,attr){scope.textModel=angular.isUndefined(scope.textModel)?0:scope.textModel;scope.showButton=angular.isUndefined(scope.showButton)?false:scope.showButton;scope.step=angular.isUndefined(scope.step)?1:scope.step;scope.precision=angular.isUndefined(scope.precision)?-1:parseInt(scope.precision);if(!angular.isUndefined(attr.textTitle)){if(attr.textTitle===""||attr.textTitle===null){scope.textTitle="请输入：";}
else{scope.textTitle=attr.textTitle;}}
scope.textPlaceholder=angular.isUndefined(attr.textPlaceholder)?'请输入数字':attr.textPlaceholder;var max=angular.isUndefined(attr.maxNum)?"max":attr.maxNum;var min=angular.isUndefined(attr.minNum)?"min":attr.minNum;if(max==""||max==null){max=100;}
if(min==""||min==null){min=0;}
scope.textModel=changetemp(scope.textModel);var key={16:"SHIFT",32:"SPACE",43:"+",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",106:"*",107:"+",109:"-",111:"/",186:";",187:"=",188:",",189:"-",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",0:"?",173:"-",229:"?"};function checkinput(keyCode){var bo=false;for(var i in key){if(i==keyCode){bo=true;break;}}
return bo;}
elem.bind('keydown',function(event){var key=event.keyCode?event.keyCode:event.which;if(checkinput(key)){if(navigator.userAgent.indexOf("MSIE")>0){window.event.returnValue=false;}
else if(event.originalEvent.returnValue){event.originalEvent.returnValue=false;}
else{event.preventDefault();}}});elem.bind('keyup',function(event){$timeout(function(){if(max!=="max"){if(parseFloat(scope.textModel)>parseFloat(max)){scope.textModel=parseFloat(max);}}
if(min!=="min"){if(parseFloat(scope.textModel)<parseFloat(min)){scope.textModel=parseFloat(min);}}},0);});elem.children("input").bind('blur',function(){if(scope.textModel||scope.textModel===0){$timeout(function(){scope.textModel=changetemp(scope.textModel);},0);}});scope.numup=function(){$timeout(function(){if(scope.textModel||scope.textModel===0){scope.textModel=add();if(max!=="max"){if(scope.textModel>parseFloat(max)){scope.textModel=parseFloat(max);}}
scope.textModel=changetemp(scope.textModel);}
if(scope.textModel==""||scope.textModel==null){scope.textModel=0+parseFloat(scope.step);scope.textModel=changetemp(scope.textModel);}},0);};scope.numdown=function(){$timeout(function(){if(scope.textModel||scope.textModel===0){scope.textModel=sub();if(min!=="min"){if(scope.textModel<parseFloat(min)){scope.textModel=parseFloat(min);}}
scope.textModel=changetemp(scope.textModel);}},0);};scope.cleanInput=function(){$timeout(function(){scope.textModel="";},0);}
function add(){var tempNum=scope.textModel.toString().split('.');var stepPrec=scope.step.toString().split('.');var integer=Number(tempNum[0])+Number(stepPrec[0]);var floatModel,floatStep;var decimal1=0,decimal2=0;try{floatModel=Number(tempNum[1]);decimal1=tempNum[1].length;}
catch(e){floatModel=0;decimal1=0;}
try{floatStep=Number(stepPrec[1]);decimal2=stepPrec[1].length;}
catch(e){floatStep=0;decimal2=0;}
var abs=Math.abs(decimal1-decimal2);var maxDec=Math.max(decimal1,decimal2);if(decimal1>decimal2){floatStep=floatStep*Math.pow(10,abs);}
else{floatModel=floatModel*Math.pow(10,abs);}
var float=(floatModel+floatStep).toString();if(float.length>maxDec&&float!=="0"){integer+=1;float=float.slice(1);}
else if(float.length<maxDec){var len=maxDec-float.length;for(var i=0;i<len;i++){float="0"+float;}}
var result=integer+"."+float;console.log(result);return result;}
function sub(){var tempNum=scope.textModel.toString().split('.');var stepPrec=scope.step.toString().split('.');var result="";var integer;var floatModel,floatStep;var decimal1=0,decimal2=0;if(stepPrec[1]==undefined){integer=Number(tempNum[0])-Number(stepPrec[0]);try{floatModel=Number(tempNum[1]);decimal1=tempNum[1].length;}
catch(e){floatModel=0;decimal1=0;}
floatStep=0;}
else{integer=Number(tempNum[0])-Number(stepPrec[0])-1;try{floatModel=Number("1"+tempNum[1]);decimal1=tempNum[1].length;}
catch(e){floatModel=10;decimal1=0;}
try{floatStep=Number(stepPrec[1]);decimal2=stepPrec[1].length;}
catch(e){floatStep=0;decimal2=0;}}
var abs=Math.abs(decimal1-decimal2);var maxDec=Math.max(decimal1,decimal2);if(decimal1>decimal2){floatStep=floatStep*Math.pow(10,abs);}
else{floatModel=floatModel*Math.pow(10,abs);}
var float=(floatModel-floatStep).toString();if(float.length<maxDec){var len=maxDec-float.length;for(var i=0;i<len;i++){float="0"+float;}}
if(float.length>maxDec){integer+=1;float=float.slice(1);}
result=integer+"."+float;console.log(result);return result;}
function changetemp(model){var jingdu=parseInt(scope.precision);if(jingdu==''||jingdu==null){jingdu=0;}
if(jingdu>-1){if(jingdu===0){model=parseInt(model);}
if(jingdu>0){var str=model+"";var temp=str.split(".",2);if(temp[0]===""){temp[0]=0;}
if(temp[1]){var littleLen=temp[1].length;if(littleLen>jingdu){temp[1]=temp[1].substring(0,jingdu);}
else{for(var i=0;i<jingdu-littleLen;i++){temp[1]=temp[1].concat("0");}}}
else{temp[1]="";for(var i=0;i<jingdu;i++){temp[1]=temp[1].concat("0");}}
model=parseInt(temp[0])+"."+temp[1];}}
return model;}},transclude:true,replace:true}});app.directive('numericBox',function($timeout){return{restrict:'E',template:function(elem,attr){var templates="";if(angular.isUndefined(attr.textTitle)){templates='<div class="input-group">'+'<input type="text" class="form-control numeric-input" '+'ng-model="textModel[0]"'+' >'+'<a class="input-cancel" style="right: 210px; right: 204px\\0; top: 7.5px" href="javascript:;"><i class="fa fa-times" style="color: gray" ng-click="cleanInput(0)"></i></a>'+'<span class="input-group-addon numeric-mid-span">到</span>'+'<input type="text" class="form-control numeric-input" '+'ng-model="textModel[1]"'+' >'+'<a class="input-cancel" style="right: 12px; top: 7.5px" href="javascript:;"><i class="fa fa-times" style="color: gray" ng-click="cleanInput(1)"></i></a>'+'</div>';}
else{templates='<div class="input-group">'+'<label class="control-label" style="display: inline-block; vertical-align: middle; padding-right: 30px">'+'{{textTitle}}'+'</label>'+'<input type="text" class="form-control numeric-input" '+'ng-model="textModel[0]"'+' >'+'<a class="input-cancel" style="right: 210px; right: 204px\\0; top: 7.5px" href="javascript:;"><i class="fa fa-times" style="color: gray" ng-click="cleanInput(0)"></i></a>'+'<span class="input-group-addon numeric-mid-span">{{textConnect}}</span>'+'<input type="text" class="form-control numeric-input" '+'ng-model="textModel[1]"'+' >'+'<a class="input-cancel" style="right: 12px; top: 7.5px" href="javascript:;"><i class="fa fa-times" style="color: gray" ng-click="cleanInput(1)"></i></a>'+'</div>';}
return templates;},scope:{textModel:'=?',precision:'=?',textConnect:'=?'},link:function(scope,elem,attr){scope.textModel=angular.isUndefined(scope.textModel)?[0,0]:scope.textModel;var max=angular.isUndefined(attr.maxNum)?"max":attr.maxNum;var min=angular.isUndefined(attr.minNum)?"min":attr.minNum;if(angular.isUndefined(scope.textConnect)||scope.textConnect==""){scope.textConnect="-";}
if(!angular.isUndefined(attr.textTitle)){if(attr.textTitle===""||attr.textTitle===null){scope.textTitle="请输入：";}
else{scope.textTitle=attr.textTitle;}}
if(max==""||max==null){max=100;}
if(min==""||min==null){min=0;}
scope.textModel[0]=changetemp(scope.textModel[0]);scope.textModel[1]=changetemp(scope.textModel[1]);var key={16:"SHIFT",32:"SPACE",43:"+",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",106:"*",107:"+",109:"-",111:"/",186:";",187:"=",188:",",189:"-",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",0:"?",173:"-",229:"?",};function checkinput(keyCode){var bo=false;for(var i in key){if(i==keyCode){bo=true;break;}}
return bo;}
elem.bind('keydown',function(event){var key=event.keyCode?event.keyCode:event.which;if(checkinput(key)){if(navigator.userAgent.indexOf("MSIE")>0){window.event.returnValue=false;}
else if(event.originalEvent.returnValue){event.originalEvent.returnValue=false;}
else{event.preventDefault();}}});elem.bind('keyup',function(event){$timeout(function(){if(max!=="max"){if(parseFloat(scope.textModel[0])>parseFloat(max)){scope.textModel[0]=parseFloat(max);}
if(parseFloat(scope.textModel[1])>parseFloat(max)){scope.textModel[1]=parseFloat(max);}}
if(min!=="min"){if(parseFloat(scope.textModel[0])<parseFloat(min)){scope.textModel[0]=parseFloat(min);}
if(parseFloat(scope.textModel[1])<parseFloat(min)){scope.textModel[1]=parseFloat(min);}}},0);});elem.children("input").bind('blur',function(){$timeout(function(){if((scope.textModel[0]||scope.textModel[0]===0)&&(scope.textModel[1]||scope.textModel[1]===0)){if(parseFloat(scope.textModel[0])>parseFloat(scope.textModel[1])){scope.textModel[0]=scope.textModel[1];}}
scope.textModel[0]=changetemp(scope.textModel[0]);scope.textModel[1]=changetemp(scope.textModel[1]);},0);});scope.cleanInput=function(n){$timeout(function(){scope.textModel[n]="";},0);}
function changetemp(model){var jingdu=angular.isUndefined(scope.precision)?-1:scope.precision;if(jingdu==''||jingdu==null){jingdu=0;}
if(jingdu>-1){if(jingdu==0){model=parseInt(model);}
if(jingdu>0){var str=model+"";var temp=str.split(".",2);if(temp[0]===""){temp[0]=0;}
if(temp[1]){var littleLen=temp[1].length;if(littleLen>jingdu){temp[1]=temp[1].substring(0,jingdu);}
else{for(var i=0;i<jingdu-littleLen;i++){temp[1]=temp[1].concat("0");}}}
else{temp[1]="";for(var i=0;i<jingdu;i++){temp[1]=temp[1].concat("0");}}
model=parseInt(temp[0])+"."+temp[1];}}
return model;}},transclude:true,replace:true}});;'use strict';app.directive('offClick',['$document','$timeout',function($document,$timeout){function targetInFilter(target,filter){if(!target||!filter)return false;var elms=angular.element(document.querySelectorAll(filter));var elmsLen=elms.length;for(var i=0;i<elmsLen;++i)
if(elms[i].contains(target))return true;return false;}
return{restrict:'A',scope:{offClick:'&',offClickIf:'&'},link:function(scope,elm,attr){if(attr.offClickIf){scope.$watch(scope.offClickIf,function(newVal,oldVal){if(newVal&&!oldVal){$timeout(function(){$document.on('click',handler);});}else if(!newVal){$document.off('click',handler);}});}else{$document.on('click',handler);}
scope.$on('$destroy',function(){$document.off('click',handler);});function handler(event){if(event.pageX==0&&event.pageY==0)return;var target=event.target||event.srcElement;if(!(elm[0].contains(target)||targetInFilter(target,attr.offClickFilter))){scope.$apply(scope.offClick());}}}};}]);;'use strict';app.directive('ctPaneltool',function(){var templates={collapse:"<a href='#' class='btn btn-transparent btn-sm' panel-collapse='' tooltip-placement='top' tooltip='Collapse' ng-click='{{panelId}} = !{{panelId}}' ng-init='{{panelId}}=false'>"+"<i ng-if='{{panelId}}' class='ti-plus'></i>"+"<i ng-if='!{{panelId}}' class='ti-minus'></i>"+"</a>",dismiss:"<a href='#' class='btn btn-transparent btn-sm' panel-dismiss='' tooltip-placement='top' tooltip='关闭'>"+"<i class='ti-close'></i>"+"</a>",refresh:"<a href='#' class='btn btn-transparent btn-sm' panel-refresh='' tooltip-placement='top' tooltip-append-to-body tooltip='刷新' data-spinner='{{spinner}}'>"+"<i class='ti-reload'></i>"+"</a>"};return{restrict:'E',template:function(elem,attrs){var temp='';if(attrs.toolCollapse)
temp+=templates.collapse.replace(/{{panelId}}/g,(elem.parent().parent().attr('id')));if(attrs.toolDismiss)
temp+=templates.dismiss;if(attrs.toolRefresh)
temp+=templates.refresh.replace(/{{spinner}}/g,attrs.toolRefresh);return temp;}};}).directive('infoArea',function(){var templates='<div ng-include="\'App/Main/assets/views/areaControl.html\'"></div>';return{restrict:'E',template:function(elem,defualt){var temp=templates;return temp;},replace:true};}).directive('popPanel',function(){var tpl='<div><div class="mask" ng-show="{{mask_show}}"></div>'+'<div class="alert" ng-show="{{mask_show}}">'+'<div class="panel panel-white col-sm-{{size}} col-sm-offset-{{marginsize}}">'+'<div class="panel-heading" style="border-bottom:1px solid #eee;">'+'<h4 class="panel-title text-primary">{{panel_title}}</h4>'+'</div>'+'<div class="panel-body">'+'<div ng-include="\'{{panel_html}}\'"></div>'+'</div></div></div></div>';return{restrict:'E',template:function(elem,attrs){if(attrs.popUrl)
tpl=tpl.replace(/{{panel_html}}/g,attrs.popUrl);if(attrs.popTitle)
tpl=tpl.replace(/{{panel_title}}/g,attrs.popTitle);if(attrs.popTitle)
tpl=tpl.replace(/{{mask_show}}/g,attrs.popShow);var size=4,marginsize=4;if(attrs.popSize){size=attrs.popSize;}
tpl=tpl.replace(/{{size}}/g,size);if(attrs.marginSize){marginsize=attrs.marginSize;}
tpl=tpl.replace(/{{marginsize}}/g,marginsize);return tpl;},replace:true};});app.directive('panelDismiss',function(){'use strict';return{restrict:'A',controller:["$scope","$element",function($scope,$element){var removeEvent='panel-remove',removedEvent='panel-removed';$element.on('click',function(){var parent=$(this).closest('.panel');destroyPanel();function destroyPanel(){var col=parent.parent();parent.fadeOut(300,function(){$(this).remove();if(col.is('[class*="col-"]')&&col.children('*').length===0){col.remove();}});}});}]};}).directive('panelRefresh',function(){'use strict';return{restrict:'A',controller:["$scope","$element",function($scope,$element){var refreshEvent='panel-refresh',csspinnerClass='csspinner',defaultSpinner='load1';function removeSpinner(){this.removeClass(csspinnerClass);}
$element.on('click',function(){var $this=$(this),panel=$this.parents('.panel').eq(0),spinner=$this.data('spinner')||defaultSpinner;panel.addClass(csspinnerClass+' '+spinner);panel.removeSpinner=removeSpinner;$this.trigger(refreshEvent,[panel]);});}]};});app.directive('ngfocus',[function(){var FOCUS_CLASS="ng-focused";return{restrict:'A',require:'ngModel',link:function(scope,element,attrs,ctrl){ctrl.$focused=false;element.bind('focus',function(evt){element.addClass(FOCUS_CLASS);scope.$apply(function(){ctrl.$focused=true;});}).bind('blur',function(evt){element.removeClass(FOCUS_CLASS);scope.$apply(function(){ctrl.$focused=false;});});}};}]);(function($,window,document){'use strict';$(document).on('panel-refresh','.panel',function(e,panel){setTimeout(function(){panel.removeSpinner();},3000);});}(jQuery,window,document));;'use strict';app.directive('panelHeader',function(SweetAlert,selfadapt){return{restrict:'E',template:function(el,att){var a='',b='',c='';if(angular.isDefined(att.onAddClick)){a='<li class="panel-tools"> '+'   <a class="btn hyperlinks" ng-click="onAddClick()"> '+'     <i class="fa fa-plus"></i>'+'    增加 </a>'+'</li>';}
if(angular.isDefined(att.onDelClick)){b='<li class="panel-tools"> '+'   <a class="btn hyperlinks" ng-click="onDelClick()"> '+'        <i class="fa fa-trash-o"></i>'+'   批量删除</a>'+'</li>';}
if(angular.isDefined(att.onExportClick)){b='<li class="panel-tools"> '+'   <a class="btn hyperlinks"tooltip="导出" ng-click="onExportClick()"> '+'        <i class="mdi-export fontsize16" style="color:#007AFF"></i>'+'    </a>'+'</li>';}
if(angular.isDefined(att.foldElement)){c='<li class="panel-tools"> '+' <fold-table-btn fold-element="foldElement" fold-id=""></fold-table-btn>'+'</li>';}
var temp='<div class="panel-heading border-bottom">'+'      <h4 class="panel-title">'+att.panelTitle+'</h4> '+'      <ul class="panel-heading-tabs border-light">'+
a+b+c+'      </ul>'+'</div>';return temp;},replace:true,scope:{foldElement:'=?',onAddClick:'=?',onDelClick:'=?',onExportClick:'=?'},link:function(scope,elem,attr){}};});;app.directive('perfectScrollbar',['$parse','$window','$rootScope',function($parse,$window,$rootScope){var psOptions=['wheelSpeed','wheelPropagation','minScrollbarLength','useBothWheelAxes','useKeyboard','suppressScrollX','suppressScrollY','scrollXMarginOffset','scrollYMarginOffset','includePadding'];return{restrict:'EA',transclude:true,template:'<div><div ng-transclude></div></div>',replace:true,link:function($scope,$elem,$attr){function update(event){$scope.$evalAsync(function(){if($attr.scrollDown=='true'&&event!='mouseenter'){setTimeout(function(){$($elem).scrollTop($($elem).prop("scrollHeight"));},100);}
$elem.perfectScrollbar('update');});}
var jqWindow=angular.element($window);var options={};if(!$rootScope.app.isMobile){for(var i=0,l=psOptions.length;i<l;i++){var opt=psOptions[i];if($attr[opt]!==undefined){options[opt]=$parse($attr[opt])();}}
$scope.$evalAsync(function(){$elem.perfectScrollbar(options);var onScrollHandler=$parse($attr.onScroll);$elem.scroll(function(){var scrollTop=$elem.scrollTop();var scrollHeight=$elem.prop('scrollHeight')-$elem.height();$scope.$apply(function(){onScrollHandler($scope,{scrollTop:scrollTop,scrollHeight:scrollHeight});});});});$elem.bind('mousemove',update);if($attr.refreshOnChange){$scope.$watchCollection($attr.refreshOnChange,function(){update();});}
if($attr.refreshOnResize){jqWindow.on('resize',update);}
$elem.bind('$destroy',function(){jqWindow.off('resize',update);$elem.perfectScrollbar('destroy');});}}};}]);;'use strict';app.directive('searchel',function($timeout,$modal){var searchWin=function(tpl,ctrl,size,winCls,backdrop,resolve,openedFun){if(backdrop===undefined||backdrop===null||backdrop===''||backdrop!=='static'){backdrop=true;}
if(resolve==='map'){resolve=loadSequences('openlayerjs','itellurojs');}
var m=$modal.open({template:tpl,controller:ctrl,backdrop:backdrop,size:size,windowClass:winCls,resolve:resolve?resolve:{}});m.opened.then(function(a){if(!openedFun)return;openedFun(a);});};function loadSequences(){var _args=arguments;return{deps:['$ocLazyLoad','$q',function($ocLL,$q){var promise=$q.when(1);for(var i=0,len=_args.length;i<len;i++){promise=promiseThen(_args[i]);}
return promise;function promiseThen(_arg){if(typeof _arg=='function')
return promise.then(_arg);else
return promise.then(function(){var nowLoad=requiredData(_arg);if(!nowLoad)
return $.error('Route resolve: Bad resource name ['+_arg+']');return $ocLL.load(nowLoad);});}
function requiredData(name){if(jsRequires.modules)
for(var m in jsRequires.modules)
if(jsRequires.modules[m].name&&jsRequires.modules[m].name===name)
return jsRequires.modules[m];return jsRequires.scripts&&jsRequires.scripts[name];}}]};}
return{restrict:'E',template:function(){var templates='<div class="input-group" style="width: 100%">'+'    <input class="form-control" type="text" placeholder="Search..." ng-model="searchModel">'+'    <span class="input-group-btn">'+'        <a href="javascript:;" class="btn btn-primary" style="border-bottom-left-radius: 0; border-top-left-radius: 0;" ng-click="onSearchReturn()">'+'            <i class="ti ti-search"></i>'+'            查询'+'        </a>'+'    </span>'+'    <div style="display: table-cell;width: 10px;" ng-if="isAdvanced">'+'    </div>'+'    <a href="javascript:;" class="btn btn-primary" ng-click="openSearchwinFun()" ng-if="isAdvanced" style="display: table-cell; width: 1%;">'+'        高级查询'+'    </a>'+'</div>';return templates;},scope:{searchwinTitle:'=?',searchwinIcon:'=?',searchwinModal:'=?',resolve:'@?',templateUrl:'@?',template:'=?',size:'@?',winClass:'@?',backdrop:'=?',onOpened:'=?',onSubmit:'=?',onCancel:'=?',openSearchwinFun:'=?',isAdvanced:'=?',searchModel:'=?',onSearchReturn:'=?',},replace:true,transclude:true,controller:function($scope,SweetAlert,$templateCache){$scope.ctrl='searchwinsCtrl'+new Date().getTime();$scope.openSearchwinFun=function(){var tmls=$scope.template?$scope.template:'    <!-- 表单 -->'+'    <form role="form" class="form-horizontal" name="$searchwin_form" novalidate ng-submit="submitForm.submit($searchwin_form)">'+
$templateCache.get($scope.templateUrl)+'        <div class="form-group" style="margin-top: 50px;margin-bottom: 0px; margin-right: 0px;">'+'            <button type="submit" style="min-width: 80px; float: right; margin-left: 0.5em;" class="btn btn-wide btn-primary">查询</button>'+'            <a style="float: right; min-width: 80px;" class="btn btn-wide btn-o btn-default" ng-click="submitForm.cancel()">取消</a>'+'        </div>'+'    </form>';tmls='<!-- Head -->'+'<div class="modal-header" style="padding:10px">'+'    <h4 style="margin-bottom: 0px;" ng-class="icon">{{title}}</h4>'+'    <a class="my-pop-win-close" href="#" ng-click="closeWin()"><i class="ti-close" tooltip="关闭"></i></a>'+'</div>'+'<!-- Body -->'+'<div class="modal-body form-error">'+
tmls+'</div>';searchWin(tmls,$scope.ctrl,$scope.size,$scope.winClass,$scope.backdrop,$scope.resolve,$scope.onOpened);};},link:function($scope,$element,$attributes){$scope.isAdvanced=angular.isUndefined($scope.isAdvanced)?false:$scope.isAdvanced;$scope.searchModel=angular.isUndefined($scope.searchModel)?"":$scope.searchModel;var mod={ppl:$scope.searchwinModal,ttl:$scope.searchwinTitle,icon:$scope.searchwinIcon},onSubmit=$scope.onSubmit,onCancel=$scope.onCancel;$scope.$watch('searchwinModal',function(val){mod.ppl=val;});$scope.$watch('searchwinTitle',function(val){mod.ttl=val;});$scope.$watch('searchwinIcon',function(val){mod.icon=val;});app.controller($scope.ctrl,['$scope','$modalInstance','SweetAlert',function($scope,$modalInstance,SweetAlert){$scope.$modalInstance=$modalInstance;$scope.searchwinModal=mod.ppl;$scope.title=mod.ttl;$scope.icon=mod.icon;$scope.$watch(function(){return mod;},function(val){$scope.title=val.ttl;$scope.icon=val.icon;$scope.searchwinModal=val.ppl;});$modalInstance.result.finally(function(){$scope.submitForm.cancel();});$scope.submitForm={submit:function(form){if(form.$invalid){var field=null,firstError=null;for(field in form){if(field[0]!='$'){if(firstError===null&&!form[field].$valid){firstError=form[field].$name;}
if(form[field].$pristine){form[field].$dirty=true;}}}
return;}else{if(!!onSubmit&&angular.isFunction(onSubmit))
onSubmit($modalInstance,form);else if(!!onSubmit&&!!onSubmit.submit&&angular.isFunction(onSubmit.submit))
onSubmit.submit($modalInstance,form);}},cancel:function(){if(!!onCancel&&angular.isFunction(onCancel))
onCancel($modalInstance);else if(!!onSubmit&&!!onSubmit.cancel&&angular.isFunction(onSubmit.cancel)){onSubmit.cancel($modalInstance);return;}
$modalInstance.dismiss('cancel');}};$scope.closeWin=function(){$scope.submitForm.cancel();};}]);}}});;'use strict';app.directive('micComboBox',['$document','$timeout',function($document,$timeout){return{restrict:'EA',scope:{value:'=?',dataset:'=?',onChange:'=?'},replace:true,template:function(elem,attrs){var temp,list,filters='',filterInput='',icon='';if(angular.isDefined(attrs.icon)&&!!attrs.icon){icon='<i class="'+attrs.icon+'"></i>　';}
if(angular.isDefined(attrs.filters)&&!!attrs.filters){var s=attrs.filters;if(s.charAt(s.length-1)===','){s=s.substring(0,s.length-1);}
s=attrs.filters.replace(/,/g,':search,');s+=':search}';filters='| propsFilter: {'+s;filterInput='<li style="width:100%;">'+'      <input type="text" placeholder="过滤..." style="width:100%;height: 34px;" ng-model="search" />'+'</li>'}
list='<div class="cs-options">'+'  <ul>'+
filterInput+'      <li ng-repeat="item in dataset '+filters+'" data-value="{{item}}">'+'        <span ng-click="itemClick(item, $event)">'+icon+' {{item.name}}</span>'+'      </li>'+'  </ul>'+'</div>';temp='<span ng-if="!!'+attrs.text+'" class="cs-placeholder"  ng-click="combClick()">{{'+attrs.text+'}}</span><span ng-if="!'+attrs.text+'" style="color:#c8c7cc;"  ng-click="combClick()">请选择</span>'+list;if(angular.isDefined(attrs.multiple)){temp='<span class="cs-multiple-select" ng-click="combClick($event)"><span class="cs-placeholder" ng-if="!value||value.length===0" style="color:#c8c7cc;">请选择</span>'+'<span class="btn btn-default btn-xs datavalues" ng-repeat="$item in value" data-value="{{$item}}" >'+'<span class="close" ng-click="delItems($item, $event)">×</span>'+'<span class="cs-placeholder mtl">{{'+attrs.text+'}}</span>'+'</span>'+'</span>'+
list;}
temp='<div class="cs-select cs-skin-elastic" tabindex="-1">'+temp+'</div>';return temp;},link:function($scope,$element,$attributes){$scope.search='';$scope.isOpen=false;var ismtl=angular.isDefined($attributes.multiple);$timeout(function(){if($element.hasClass('cs-skin-slide')){$element.removeClass('cs-skin-elastic');}
$scope.$watch(function(){return!$scope.dataset?!!$scope.dataset:$scope.dataset.length+$scope.search;},function(a){if(!a||$attributes.disabled){return;}
$timeout(function(){initSelect();});});});$scope.delItems=function(item,evt){if($attributes.disabled){return;}
angular.element(evt.target.parentNode).remove();removeValues(item);var val=angular.toJson(item),lis=$element.find('ul li.ng-scope');lis.each(function(a,b){var li=angular.element(b);if(li.attr('data-value')===val){removeSelectedEl(item,li);return false;}});backFun();}
function initSelect(){var els=$element.find('ul li.ng-scope');els.each(function(a,b){var elo=angular.element(b);if(ismtl){for(var i in $scope.value){if(angular.toJson($scope.value[i])===elo.attr('data-value')){elo.addClass('cs-selected');}}}else if(angular.toJson($scope.value)===elo.attr('data-value')){elo.addClass('cs-selected');return false;}});}
$scope.combClick=function(evt){if($attributes.disabled){return;}
if(!!evt&&hasEl(evt)){return;}
$scope.isOpen=!$scope.isOpen;initSelect();if($scope.isOpen)
$element.addClass('cs-active');else
$element.removeClass('cs-active');};function hasEl(evt){var ele=angular.element(evt.target);if(ele.hasClass('close'))
return true;else if(ele.hasClass('mtl'))
return true;else if(ele.hasClass('btn'))
return true;else
return false;}
$scope.itemClick=function(item,evt){if($attributes.disabled){return;}
var el=angular.element(evt.target).parent();if(ismtl){if(!el.hasClass('cs-selected')){$scope.value.push(item);el.addClass('cs-selected');}else{removeValues(item);removeSelectedEl(item,el);}}else{$scope.value=angular.copy(item);$scope.isOpen=false;var oldOpt=$element.find('li.cs-selected');if(oldOpt){oldOpt.removeClass('cs-selected');}
el.addClass('cs-selected');$element.removeClass('cs-active');}
backFun();};function backFun(){$timeout(function(){$scope.onChange($scope.value);});}
function removeValues(item){var val=angular.toJson(item);for(var i in $scope.value){if(angular.toJson($scope.value[i])===val){$scope.value.splice(i,1);break;}}}
function removeSelectedEl(item,el){var val=angular.toJson(item);var spanEl=$element.find('span.datavalues');spanEl.each(function(a,b){var moveEl=angular.element(b);if(moveEl.attr('data-value')===val){moveEl.remove();return false;}});el.removeClass('cs-selected');}
$document.click(function(ev){if($attributes.disabled){return;}
if(!!ev&&hasEl(ev)){return;}
var target=ev.target;if($scope.isOpen&&target!==$element[0]&&!hasParent(target,$element[0])){$scope.isOpen=false;$element.removeClass('cs-active');}});function hasParent(e,p){if(!e)
return false;var el=e.target||e.srcElement||e||false;while(el&&el!=p){el=el.parentNode||false;}
return(el!==false);};}};}]);;'use strict';app.service('selfadapt',function($rootScope,$timeout,$document){var _self=this;this.hideBodyScroll=function(){$document.find('body').css('overflow-y','hidden');};this.showBodyScroll=function(){$document.find('body').css('overflow-y','auto');}
this._panelH=function(){return window.innerHeight-$document.find('.navbar-collapse').outerHeight()-$document.find('#app > footer').outerHeight();};this._isMobileBrowser=function(){var u=navigator.userAgent;if(u.indexOf('Trident')>-1){return true;}
else if(u.indexOf('chrome')>-1||u.indexOf('Chrome')>-1){return true;}
else if(u.indexOf('Gecko')>-1&&u.indexOf('KHTML')==-1){return true;}
else{return false;}};this.onChange=function($el){if(!_self._isMobileBrowser()){return;}
$timeout(function(){var plel=$el.find(".panel-fold"),el=$el.find(".mapDiv");if(plel.length===0||el.length===0){return;}
var h=_self._panelH();angular.forEach(plel,function(a){h-=plel[0].offsetHeight;});if(el.length===1){var pEl=el.parents('.container_padding'),m=0,n=0,z=0;if(pEl.length!==0){m=parseInt(pEl.css('padding-top')),n=parseInt(pEl.css('padding-bottom')),z=parseInt(pEl.children('div:first-child').css('margin-bottom'));h-=(m+n+z*2);}
el.height(h);}},120);};this.anyChange=function($el){if(!_self._isMobileBrowser()){return;}
return $rootScope.$watch(function(){if(window.innerWidth<768){_self.showBodyScroll();return false;}
return _self._panelH()+window.innerWidth+$el.outerHeight();},function(p){if(!p){return;}
_self.hideBodyScroll();_self.onChange($el);var h=_self._panelH();var el=$el.find(".panel-fixed");if(el.length===0){return;}
angular.forEach(el,function(a,b){var enPanelFixed=angular.element(a);if(enPanelFixed.hasClass('panel-body')){var pEl=enPanelFixed.parents('.container_padding'),m=0,n=0,z=0;if(pEl.length!==0){m=parseInt(pEl.css('padding-top')),n=parseInt(pEl.css('padding-bottom')),z=parseInt(enPanelFixed.css('padding-top'));}
var headPanel=enPanelFixed.parent().children('.panel-heading');var enH=h-headPanel.outerHeight()-m-n-z-16;enPanelFixed.height(enH);var mapEl=enPanelFixed.find('.mapDiv');if(mapEl.length===0){return;}
mapEl.height(enH-2);}});});}});;'use strict';app.directive('sidebar',['$document','$rootScope',function($document,$rootScope){return{replace:false,restrict:"C",link:function(scope,elem,attrs){var shouldCloseOnOuterClicks=true;if(attrs.closeOnOuterClicks=='false'||attrs.closeOnOuterClicks=='0'){shouldCloseOnOuterClicks=false;}
var isAncestorOrSelf=function(element,target){var parent=element;while(parent.length>0){if(parent[0]===target[0]){parent=null;return true;}
parent=parent.parent();}
parent=null;return false;};var closeOnOuterClicks=function(e){if(!isAncestorOrSelf(angular.element(e.target),elem)){$rootScope.toggle(attrs.id,'off');e.preventDefault();return false;}};var clearCb1=angular.noop();if(shouldCloseOnOuterClicks){clearCb1=$rootScope.$on('clip-two.toggled',function(e,id,active){if(id==attrs.id){if(active){setTimeout(function(){$document.on('click tap',closeOnOuterClicks);},300);}else{$document.off('click tap',closeOnOuterClicks);}}});}
scope.$on('$destroy',function(){clearCb1();$document.off('click tap',closeOnOuterClicks);});}};}]).directive('searchForm',function($timeout){return{restrict:'AC',link:function(scope,elem,attrs){$timeout(function(){var wrap=$('.app-aside');var searchForm=elem.children('form');$(".s-open").on('click',function(e){searchForm.prependTo(wrap);$(document).on("mousedown touchstart",closeForm);});$(".s-remove").on('click',function(e){searchForm.appendTo(elem);});var closeForm=function(e){if(!searchForm.is(e.target)&&searchForm.has(e.target).length===0){$(".s-remove").trigger('click');$(document).off("mousedown touchstart",closeForm);}};});scope.$on('$destroy',function(){$(document).off("mousedown touchstart");$(".s-remove").off("click");$(".s-open").off('click');});}};function isSidebarClosed(){return $('.app-sidebar-closed').length;}
function isSidebarFixed(){return $('.app-sidebar-fixed').length;}}).directive('appAside',['$window','$rootScope','$timeout','APP_MEDIAQUERY',function($window,$rootScope,$timeout,mq){var $html,$win,_this,wrap;return{restrict:'AC',link:function(scope,elem,attrs,controllers){$timeout(function(){$html=$('html');$win=$($window);wrap=$('.app-aside');;var eventObject=$html.hasClass('touch')?'click':'mouseenter';var ul="";var menuTitle;elem.on('click','a',function(e){_this=$(this);if(isSidebarClosed()&&!isMobile()&&!_this.closest("ul").hasClass("sub-menu"))
return;_this.closest("ul").find(".open").not(".active").children("ul").not(_this.next()).slideUp(200).parent('.open').removeClass("open");if(_this.next().is('ul')&&_this.parent().toggleClass('open')){_this.next().slideToggle(200,function(){$win.trigger("resize");});e.stopPropagation();e.preventDefault();}else{$rootScope.toggle('sidebar','off');}});elem.on(eventObject,'a',function(e){if(!isSidebarClosed()||isMobile())
return;_this=$(this);if(!_this.parent().hasClass('hover')&&!_this.closest("ul").hasClass("sub-menu")){wrapLeave();_this.parent().addClass('hover');menuTitle=_this.find(".item-inner").clone();if(_this.parent().hasClass('active')){menuTitle.addClass("active");}
var offset=$("#sidebar").position().top;var itemTop=isSidebarFixed()?_this.parent().position().top+offset:(_this.parent().position().top);menuTitle.css({position:isSidebarFixed()?'fixed':'absolute',height:_this.outerHeight(),top:itemTop}).appendTo(wrap);if(_this.next().is('ul')){ul=_this.next().clone(true);ul.appendTo(wrap).css({top:menuTitle.position().top+_this.outerHeight(),position:isSidebarFixed()?'fixed':'absolute',});if(_this.parent().position().top+_this.outerHeight()+offset+ul.height()>$win.height()&&isSidebarFixed()){ul.css('bottom',0);}else{ul.css('bottom','auto');}
wrap.children().first().scroll(function(){if(isSidebarFixed())
wrapLeave();});setTimeout(function(){if(!wrap.is(':empty')){$(document).on('click tap',wrapLeave);}},300);}else{ul="";return;}}});wrap.on('mouseleave',function(e){$(document).off('click tap',wrapLeave);$('.hover',wrap).removeClass('hover');$('> .item-inner',wrap).remove();$('> ul',wrap).remove();});$rootScope.$on('$locationChangeSuccess',function(){var newPath;newPath=window.location.hash;angular.forEach(elem.find('.main-navigation-menu a'),function(domLink){var link=angular.element(domLink);var menu;if(domLink.hash===newPath&&(!isSidebarClosed()||isMobile())){if(link.closest("ul").hasClass("sub-menu")){menu=link.closest("ul");var activeMenu=menu;menu.slideDown(200).parent().siblings().children('.sub-menu').slideUp(200,function(){$(this).parent().removeClass("open");});}else{$('.sub-menu').slideUp(200,function(){$(this).parent().removeClass("open");});}}
activeMenu=null;menu=null;});});});scope.$on('$destroy',function(){elem.off('click','a');elem.off('mouseenter','a');wrap.off('mouseleave');$rootScope.$on('$locationChangeSuccess',function(){});});}};function wrapLeave(){wrap.trigger('mouseleave');}
function isMobile(){return $win.width()<mq.desktop;}
function isSidebarClosed(){return $('.app-sidebar-closed').length;}
function isSidebarFixed(){return $('.app-sidebar-fixed').length;}}]);;'use strict';app.directive('jqSparkline',[function(){'use strict';return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ngModel){var opts={};opts.type=attrs.type||'line';opts.barColor=attrs.barColor||'#000000';opts.height=attrs.height||'35px';opts.width=attrs.width||'35px';opts.barWidth=attrs.barWidth||'5px';opts.barSpacing=attrs.barSpacing||'2px';opts.zeroAxis=attrs.zeroAxis||'true';opts.resize=attrs.resize||false;opts.fillColor=attrs.fillColor||'#cdf';opts.lineWidth=attrs.lineWidth||1;opts.lineColor=attrs.lineColor||'#00f';opts.spotColor=attrs.spotColor||'#f80';opts.spotRadius=attrs.spotRadius||1.5;opts.minSpotColor=attrs.minSpotColor||'#f80';opts.maxSpotColor=attrs.maxSpotColor||'#f80';opts.highlightSpotColor=attrs.highlightSpotColor||'#5f5';opts.highlightLineColor=attrs.highlightLineColor||'#f22';scope.$watch(attrs.ngModel,function(){render();});scope.$watch(attrs.opts,function(){render();});var render=function(){var model;if(attrs.opts)
angular.extend(opts,angular.fromJson(attrs.opts));console.log(opts);angular.isString(ngModel.$viewValue)?model=ngModel.$viewValue.replace(/(^,)|(,$)/g,""):model=ngModel.$viewValue;var data;angular.isArray(model)?data=model:data=model.split(',');$(elem).sparkline(data,opts);};var sparkResize;$(window).resize(function(e){if(opts.resize){clearTimeout(sparkResize);sparkResize=setTimeout(render,500);}});}};}]);;'use strict';app.directive('statisticalContent',function($timeout){return{restrict:'E',template:function(){var templates=' <a href="javascript:;" class="btn btn-primary" ng-click="queryWindow()">'+' 组合条件查询 '+' </a>'
return templates;},scope:{searchModel:'=?',onSearchReturn:'=?',onAdvanceReturn:'=?'},controller:['$scope','$timeout','SweetAlert','$modal',function($scope,$timeout,SweetAlert,$modal){var ctrl="kneeWindow";var tempModel={confirmFun:function(){if(angular.isUndefined($scope.onAdvanceReturn)){console.log($scope.advanceModel);}
else{$scope.onAdvanceReturn();}}};app.controller(ctrl,['$scope','$modalInstance','SweetAlert','abp.services.app.area',function($scope,$modalInstance,SweetAlert,area){$scope.searchData=tempModel.searchData;console.log($scope);$scope.showProv=[];$scope.showCity=[];$scope.showCounty=[];$scope.showTown=[];$scope.tempshowCity={};$scope.tempshowCounty={};$scope.tempshowTown={};area.getProvinces({token:AccessTokenValues}).success(function(data,statue){$scope.showProv=addChoice(data);});$scope.toCity=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowCity[code]=[];var down=code.substr(0,3);$scope.showCounty=closeDown($scope.tempshowCounty,down);$scope.showTown=closeDown($scope.tempshowTown,down);$scope.showCity=getShow($scope.tempshowCity);for(var i in $scope.searchData.provincesData){if($scope.searchData.provincesData[i].districtCode==one.districtCode){$scope.searchData.provincesData.splice(i,1);break;}}
$scope.searchData.cityData=closeChoose($scope.searchData.cityData,down);$scope.searchData.countyData=closeChoose($scope.searchData.countyData,down);$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getCity({token:AccessTokenValues,proviceCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowCity[code]=data;$scope.showCity=getShow($scope.tempshowCity);console.log($scope.showCity);});$scope.searchData.provincesData=$scope.searchData.provincesData.concat(one);}}
$scope.toCounty=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowCounty[code]=[];var down=code.substr(0,5);$scope.showTown=closeDown($scope.tempshowTown,down);$scope.showCounty=getShow($scope.tempshowCounty);for(var i in $scope.searchData.cityData){if($scope.searchData.cityData[i].districtCode==one.districtCode){$scope.searchData.cityData.splice(i,1);break;}}
$scope.searchData.countyData=closeChoose($scope.searchData.countyData,down);$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getCounty({token:AccessTokenValues,cityCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowCounty[code]=data;$scope.showCounty=getShow($scope.tempshowCounty);console.log($scope.showCounty);});$scope.searchData.cityData=$scope.searchData.cityData.concat(one);}}
$scope.toTowns=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowTown[code]=[];$scope.showTown=getShow($scope.tempshowTown);for(var i in $scope.searchData.countyData){if($scope.searchData.countyData[i].districtCode==one.districtCode){$scope.searchData.countyData.splice(i,1);break;}}
$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getTowns({token:AccessTokenValues,countyCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowTown[code]=data;$scope.showTown=getShow($scope.tempshowTown);});$scope.searchData.countyData=$scope.searchData.countyData.concat(one);}}
$scope.forTown=function(one){if(one.isChecked){one.isChecked=false;for(var i in $scope.searchData.townsData){if($scope.searchData.townsData[i].districtCode==one.districtCode){$scope.searchData.townsData.splice(i,1);break;}}}
else{one.isChecked=true;$scope.searchData.townsData=$scope.searchData.townsData.concat(one);}}
$scope.confirmBtn={confirm:function(){tempModel.confirmFun();$modalInstance.dismiss('close');},cancel:function(){$modalInstance.dismiss('cancel');}};function addChoice(data){for(var i=0;i<data.length;i++){data[i].isChecked=false;}
return data;}
function getShow(obj){var temp=[];for(var i in obj){temp=temp.concat(obj[i]);}
return temp;}
function closeDown(data,down){for(var j in data){if(j.indexOf(down)>-1){data[j]=[];}}
return getShow(data);}
function closeChoose(data,down){for(var j in data){var perpare="";if(data[j].townCode){perpare="d"+data[j].townCode;}
else{perpare="d"+data[j].districtCode;}
if(perpare.indexOf(down)>-1){data[j]=[];}}
return getShow(data);}}]);var tpl='<!-- Head -->'+'<div class="modal-header  " style="padding:10px">'+'    <h4 style="margin-bottom: 0px; color: #007AFF;">组合统计条件</h4>'+'    <a class="my-pop-win-close" href="#" ng-click="confirmBtn.cancel()"><i class="ti-close" tooltip="关闭"></i></a>'+'</div>'+'<!-- Body -->'+'<div class="modal-body combinedConditionsSearch ">'+'    <!--组合条件字段-->'+'    <div class="combined-group" style="margin-bottom: 0;">'+'        <h3 style="font-size:16px;">组合条件字段:</h3>'+'        <div  class="combined-search-number"    style="margin: 0 5px 0 5px;border:1px solid #C9C9C9">'+'          <ul >'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'         </ul>'+'        </div>'+'       <div class="combined-conditions" style="margin:15px 5px 0 5px ;">'+'           <table  cellpadding="5" cellspacing="5" border="1" >'+'               <tr><td>=</td><td><></td><td>></td><td>>=</td></tr>'+'               <tr><td><</td><td><=</td><td>-</td><td>%</td></tr>'+'               <tr><td>(</td><td>)</td><td>Or</td><td>And</td></tr>'+'               <tr><td>Like</td><td>Not</td><td>Is</td><td>null</td></tr>'+'           </table>  '+'           <div class="disaster-number"  >'+'             <ul >'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'              </ul>'+'          </div>'+'       </div>'+'    </div>'+'    <!--组合条件字段over-->'+'    <div style="margin-top: 20px; padding-bottom: 10px; border-top: 1px solid rgba(0,0,0,0.1);">'+'    </div>'+'    <!--查询语句-->'+'    <div class="combined-searchTxt" style="margin:0px 5px 50px 5px;"  >'+'        <h3 style="font-size:16px;">查询语句:</h3>'+'            <textarea rows="6" cols="120">'+'灾害体编号 <= 10349945990048'+'            </textarea>'+'   </div>'+'    <div style="position: absolute; bottom: 15px; right: 20px;">'+'        <a class="btn btn-wide btn-default btn-o" href="javascript:;" style="min-width: 80px;" ng-click="confirmBtn.cancel()">取消</a>'+'        <a class="btn btn-wide btn-primary" href="javascript:;" style="min-width: 80px; margin-left: 0.5em;" ng-click="confirmBtn.confirm()">查询</a>'+'    </div>'+'    <div style="position: absolute; bottom: 15px; left: 20px;">'+'        <a class="btn btn-wide btn-default btn-o" href="javascript:;" style="min-width: 80px;" ng-click="confirmBtn.clear()">清除</a>'+'        <a class="btn btn-wide btn-primary" href="javascript:;" style="min-width: 80px; margin-left: 0.5em;" ng-click="confirmBtn.check()">检查</a>'+'    </div>'+'</div>';$scope.queryWindow=function(){$modal.open({template:tpl,controller:ctrl,size:'lg',windowClass:''});}}],link:function(scope,elem,attr){scope.searchModel=angular.isUndefined(scope.searchModel)?"":scope.searchModel;},transclude:true,replace:true}});;'use strict';app.directive('combinedSearch',function($timeout){return{restrict:'E',template:function(){var templates=' <a href="javascript:;" class="btn btn-primary" ng-click="queryWindow()">'+' 组合条件查询 '+' </a>'
return templates;},scope:{searchModel:'=?',onSearchReturn:'=?',onAdvanceReturn:'=?'},controller:['$scope','$timeout','SweetAlert','$modal',function($scope,$timeout,SweetAlert,$modal){var ctrl="kneeWindow";var tempModel={confirmFun:function(){if(angular.isUndefined($scope.onAdvanceReturn)){console.log($scope.advanceModel);}
else{$scope.onAdvanceReturn();}}};app.controller(ctrl,['$scope','$modalInstance','SweetAlert','abp.services.app.area',function($scope,$modalInstance,SweetAlert,area){$scope.searchData=tempModel.searchData;console.log($scope);$scope.showProv=[];$scope.showCity=[];$scope.showCounty=[];$scope.showTown=[];$scope.tempshowCity={};$scope.tempshowCounty={};$scope.tempshowTown={};area.getProvinces({token:AccessTokenValues}).success(function(data,statue){$scope.showProv=addChoice(data);});$scope.toCity=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowCity[code]=[];var down=code.substr(0,3);$scope.showCounty=closeDown($scope.tempshowCounty,down);$scope.showTown=closeDown($scope.tempshowTown,down);$scope.showCity=getShow($scope.tempshowCity);for(var i in $scope.searchData.provincesData){if($scope.searchData.provincesData[i].districtCode==one.districtCode){$scope.searchData.provincesData.splice(i,1);break;}}
$scope.searchData.cityData=closeChoose($scope.searchData.cityData,down);$scope.searchData.countyData=closeChoose($scope.searchData.countyData,down);$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getCity({token:AccessTokenValues,proviceCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowCity[code]=data;$scope.showCity=getShow($scope.tempshowCity);console.log($scope.showCity);});$scope.searchData.provincesData=$scope.searchData.provincesData.concat(one);}}
$scope.toCounty=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowCounty[code]=[];var down=code.substr(0,5);$scope.showTown=closeDown($scope.tempshowTown,down);$scope.showCounty=getShow($scope.tempshowCounty);for(var i in $scope.searchData.cityData){if($scope.searchData.cityData[i].districtCode==one.districtCode){$scope.searchData.cityData.splice(i,1);break;}}
$scope.searchData.countyData=closeChoose($scope.searchData.countyData,down);$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getCounty({token:AccessTokenValues,cityCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowCounty[code]=data;$scope.showCounty=getShow($scope.tempshowCounty);console.log($scope.showCounty);});$scope.searchData.cityData=$scope.searchData.cityData.concat(one);}}
$scope.toTowns=function(one){var code="d"+one.districtCode;if(one.isChecked){one.isChecked=false;$scope.tempshowTown[code]=[];$scope.showTown=getShow($scope.tempshowTown);for(var i in $scope.searchData.countyData){if($scope.searchData.countyData[i].districtCode==one.districtCode){$scope.searchData.countyData.splice(i,1);break;}}
$scope.searchData.townsData=closeChoose($scope.searchData.townsData,down);}
else{one.isChecked=true;area.getTowns({token:AccessTokenValues,countyCode:one.districtCode}).success(function(data,statue){data=addChoice(data);$scope.tempshowTown[code]=data;$scope.showTown=getShow($scope.tempshowTown);});$scope.searchData.countyData=$scope.searchData.countyData.concat(one);}}
$scope.forTown=function(one){if(one.isChecked){one.isChecked=false;for(var i in $scope.searchData.townsData){if($scope.searchData.townsData[i].districtCode==one.districtCode){$scope.searchData.townsData.splice(i,1);break;}}}
else{one.isChecked=true;$scope.searchData.townsData=$scope.searchData.townsData.concat(one);}}
$scope.confirmBtn={confirm:function(){tempModel.confirmFun();$modalInstance.dismiss('close');},cancel:function(){$modalInstance.dismiss('cancel');}};function addChoice(data){for(var i=0;i<data.length;i++){data[i].isChecked=false;}
return data;}
function getShow(obj){var temp=[];for(var i in obj){temp=temp.concat(obj[i]);}
return temp;}
function closeDown(data,down){for(var j in data){if(j.indexOf(down)>-1){data[j]=[];}}
return getShow(data);}
function closeChoose(data,down){for(var j in data){var perpare="";if(data[j].townCode){perpare="d"+data[j].townCode;}
else{perpare="d"+data[j].districtCode;}
if(perpare.indexOf(down)>-1){data[j]=[];}}
return getShow(data);}}]);var tpl='<!-- Head -->'+'<div class="modal-header  " style="padding:10px">'+'    <h4 style="margin-bottom: 0px; color: #007AFF;">组合统计条件</h4>'+'    <a class="my-pop-win-close" href="#" ng-click="confirmBtn.cancel()"><i class="ti-close" tooltip="关闭"></i></a>'+'</div>'+'<!-- Body -->'+'<div class="modal-body combinedConditionsSearch ">'+'    <!--组合条件字段-->'+'    <div class="combined-group" style="margin-bottom: 0;">'+'        <h3 style="font-size:16px;">组合条件字段:</h3>'+'        <div  class="combined-search-number"    style="margin: 0 5px 0 5px;border:1px solid #C9C9C9">'+'          <ul >'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'                <li >灾害体编号</li>'+'         </ul>'+'        </div>'+'       <div class="combined-conditions" style="margin:15px 5px 0 5px ;">'+'           <table  cellpadding="5" cellspacing="5" border="1" >'+'               <tr><td>=</td><td><></td><td>></td><td>>=</td></tr>'+'               <tr><td><</td><td><=</td><td>-</td><td>%</td></tr>'+'               <tr><td>(</td><td>)</td><td>Or</td><td>And</td></tr>'+'               <tr><td>Like</td><td>Not</td><td>Is</td><td>null</td></tr>'+'           </table>  '+'           <div class="disaster-number"  >'+'             <ul >'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'                <li >201893849375</li>'+'              </ul>'+'          </div>'+'       </div>'+'    </div>'+'    <!--组合条件字段over-->'+'    <div style="margin-top: 20px; padding-bottom: 10px; border-top: 1px solid rgba(0,0,0,0.1);">'+'    </div>'+'    <!--查询语句-->'+'    <div class="combined-searchTxt" style="margin:0px 5px 50px 5px;"  >'+'        <h3 style="font-size:16px;">查询语句:</h3>'+'            <textarea rows="6" cols="120">'+'灾害体编号 <= 10349945990048'+'            </textarea>'+'   </div>'+'    <div style="position: absolute; bottom: 15px; right: 20px;">'+'        <a class="btn btn-wide btn-default btn-o" href="javascript:;" style="min-width: 80px;" ng-click="confirmBtn.cancel()">取消</a>'+'        <a class="btn btn-wide btn-primary" href="javascript:;" style="min-width: 80px; margin-left: 0.5em;" ng-click="confirmBtn.confirm()">查询</a>'+'    </div>'+'    <div style="position: absolute; bottom: 15px; left: 20px;">'+'        <a class="btn btn-wide btn-default btn-o" href="javascript:;" style="min-width: 80px;" ng-click="confirmBtn.clear()">清除</a>'+'        <a class="btn btn-wide btn-primary" href="javascript:;" style="min-width: 80px; margin-left: 0.5em;" ng-click="confirmBtn.check()">检查</a>'+'    </div>'+'</div>';$scope.queryWindow=function(){$modal.open({template:tpl,controller:ctrl,size:'lg',windowClass:''});}}],link:function(scope,elem,attr){scope.searchModel=angular.isUndefined(scope.searchModel)?"":scope.searchModel;},transclude:true,replace:true}});;'use strict';app.directive('micDataTable',function(MicTablesServer,$timeout){return{restrict:'E',template:function(el,attrs){function retPage(tpl){if(!angular.isDefined(attrs.pageing)){return tpl;}
return'<div>'+tpl+'<div style="height:34px;margin-top:5px;">'+'    <pagination style="float:left" first-text="首页" previous-text="上一页" next-text="下一页" last-text="末页" items-per-page="pageSize"'+'                total-items="pageing.pageCounts" ng-model="pageIndex" max-size="maxSize" class="pagination-sm"'+'                boundary-links="true" boundary-go="true" rotate="false" num-pages="totalPages" ng-change="pageChanged()"></pagination>'+'    <ul class="pagination" style="float: left;margin: 4px 0 0 !important;">'+'    <li><input type="text" style="margin-left: 10px;float: left;width:40px;border-radius: 4px !important;" ng-model="goPage" ng-keydown="pageChanged(goPage,$event)" /></li>'+'    <li><a style="padding: 4px 10px;" ng-click="pageChanged(goPage)">GO</a></li>'+'    <li>'+'        <label style="float: left;border:none;margin-left: 5px;padding: 4px 10px;position: relative;line-height: 1.52857143;text-decoration: none;margin-bottom: 0px;">第{{pageIndex}}页/共{{totalPages}}页，总计{{pageing.pageCounts}}条记录。</label>'+'    </li></ul>'+'</div></div>';}
var tmp,c1='',cstr='',c2=' table-striped property-table',tr,tbodyHeight=attrs.tbodyHeight?attrs.tbodyHeight+'px;':'auto;';if(angular.isDefined(attrs.tableBordered)){c1=' ibordered';c2=' table-bordered  table-hover';cstr='ng-class="{\'table-selected\':row.selected}"';}
if(angular.isDefined(attrs.dynamic)){tmp='<div class="mic-tables '+c1+'" >'+'<div class="mic-tables-thdiv"><table class="th-tables table '+c2+'">'+'   <thead>'+'       <tr>'+'           <th ng-repeat="item in datasets.th track by $index"><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">{{item}}</div></th>'+'       </tr>'+'   </thead>'+'</table></div>'+'<div class="mic-tables-div" style="overflow-y: auto;overflow-x:hidden;height:'+tbodyHeight+'">'+'   <table class="table '+c2+'">'+'       <tbody>'+'           <tr '+cstr+' ng-click="tableSelected(row,$event)" ng-repeat="row in datasets.td">'+'                <td ng-repeat="col in row"><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">'+'                   <a ng-if="col.isclick" ng-click="col.click(col.name)">{{col.name}}</a>'+'                   <span ng-if="!col.isclick">{{col.name}}</span>'+'                </div></td>'+'           </tr>'+'       </tbody>'+'   </table>'+'</div>'+'</div>';return tmp=retPage(tmp);;}
var micTabServ=new MicTablesServer({attrs:attrs,cellFunName:'cellClickFun',row:'row',btnFunName:'table_btn_click'});var backCell=micTabServ._createTableCell();var thead=backCell.thead;tmp=backCell.td;if(angular.isDefined(attrs.tableBtnHtml)){var backBtn=micTabServ._createTableBtn();thead+=backBtn.thead;tmp+=backBtn.td;}
var checkbox='',checkbox1='';if(angular.isDefined(attrs.checkable)){var idall='chall_'+new Date().getTime();checkbox='<th style="width:37px;padding: 0px 8px;">'+'<div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;width:22px;"><div style="margin-top: 4px;" class="checkbox clip-check check-primary">'+' <input type="checkbox" id="'+idall+'" ng-checked="allischecked" ng-click="tableCheckClick()">'+'        <label style="padding-left: 22px !important;margin-right: 0px !important;" for="'+idall+'"></label>'+'</div></div>'+'</th>';checkbox1='<td style="width:37px;padding: 0px 8px;">'+'<div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;width:22px"><div style="margin-top: 4px;" class="checkbox clip-check check-primary">'+' <input type="checkbox" id="ch_{{row.$$hashKey}}" ng-checked="row.ischecked" ng-click="tableCheckClick(row)">'+'        <label style="padding-left: 22px !important;margin-right: 0px !important;" for="ch_{{row.$$hashKey}}"></label>'+'</div></div>'+'</td>';}
if(angular.isDefined(attrs.chooseState)){tr='<tr '+cstr+' ng-click="tableSelected(row,$event,$index)" ng-class="{currentIndex:i===currentIndex}"   style="cursor:pointer" ng-repeat="(i,row) in datasets">'+
checkbox1+tmp+'</tr>';}else{tr='<tr '+cstr+' ng-click="tableSelected(row,$event)"    style="cursor:pointer" ng-repeat="row in datasets">'+
checkbox1+tmp+'</tr>';}
tmp='<div class="mic-tables '+c1+'">'+'<div class="mic-tables-thdiv"><table class="th-tables table '+c2+'">'+'<thead>'+'<tr>'+checkbox+'<th><div style="text-align:left;margin:0;white-space:nowrap;word-wrap:normal;overflow:hidden;display:block;text-overflow:ellipsis;">'+thead+'</div></th></tr>'+'</thead>'+'</table></div>'+'<div class="mic-tables-div" style="overflow-y:auto;overflow-x:hidden;height:'+tbodyHeight+'">'+'<table class="table '+c2+'">'+'<tbody>'+tr+'</tbody>'+'</table>'+'</div>'+'</div>';tmp=retPage(tmp);return tmp;},scope:{datasets:'=?',checkedData:'=?',tableBtnParams:'=?',pageing:'=?',tbodyHeight:'=?',allischecked:'=?',onDetailClick:'=?',onCellClick:'=?',onPageChange:'=?'},controller:['$scope','$element',function($scope,$element){if($scope.pageing){$scope.maxSize=angular.isDefined($scope.pageing.maxSize)?$scope.pageing.maxSize:5;$scope.goPage=1;$scope.pageCounts=$scope.pageing.pageCounts;$scope.pageIndex=$scope.pageing.pageIndex?$scope.pageing.pageIndex:1;$scope.pageSize=$scope.pageing.pageSize?$scope.pageing.pageSize:10;$scope.pageChanged=function(a,evt){if(evt&&evt.keyCode!==13){return;}
if(a){a=parseInt(a);if(isNaN(a)||a<1||a>$scope.totalPages){$scope.goPage=$scope.pageIndex;return;}
$scope.goPage=a;$scope.pageIndex=a;}
$scope.pageing.pageIndex=$scope.pageIndex;$scope.onPageChange();};}
$scope.$watch('datasets',function(d){for(var k in $scope.datasets){if(!$scope.datasets[k].tableBtnParams)
$scope.datasets[k].tableBtnParams=angular.copy($scope.tableBtnParams);}},true);function setth(){$timeout(function(){var th_arr=$element.find('table.th-tables>thead>tr>th');var w=$element.find('div.mic-tables-div>table').width();$element.find('div.mic-tables-div>table')[0].style.width='100%';$element.find('table.th-tables')[0].style.width='100%';$element.find('div.mic-tables-div>table')[0].style.tableLayout='fixed';$element.find('table.th-tables')[0].style.tableLayout='fixed';if($element.find('div.mic-tables')[0]){$element.find('div.mic-tables')[0].style.overflowY='hidden';$element.find('div.mic-tables')[0].style.overflowX='hidden';}else{$element[0].style.overflowY='hidden';$element[0].style.overflowX='hidden';}
$element.find('.mic-tables-thdiv')[0].style.width='auto';$element.find('.mic-tables-div')[0].style.width='auto';var h=0;var e1=$element.find('table:last');var e2=$element.find('div.mic-tables-div');if(e1.height()>e2.height()){h=!$scope.tbodyHeight?0:17;}
$element.find('.mic-tables-thdiv')[0].style.paddingRight=h+'px';var td_arr=$element.find('div.mic-tables-div>table>tbody>tr:first>td');if(td_arr.length===0){return;}
for(var i=0;i<th_arr.length;i++){if(td_arr[i].style.width){angular.element(th_arr[i]).css('width',td_arr[i].style.width);}else{var setw=td_arr[i].offsetWidth/w*100;angular.element(th_arr[i]).css('width',setw+'%');angular.element(td_arr[i]).css('width',setw+'%');}}},26);}
function setth11(){$timeout(function(){var th_arr=$element.find('table.th-tables>thead>tr>th');var w=$element.find('div.mic-tables-div>table').width();$element.find('div.mic-tables-div>table')[0].style.width='100%';$element.find('table.th-tables')[0].style.width='100%';var td_arr=$element.find('div.mic-tables-div>table>tbody>tr:first>td');if(td_arr.length===0){return};for(var i=0;i<th_arr.length;i++){if(td_arr[i].style.width){angular.element(th_arr[i]).css('width',td_arr[i].style.width);}else{var el1=angular.element(th_arr[i]),el2=angular.element(td_arr[i]),w1=el1.width(),w2=el2.width(),w3=th_arr[i].innerText.length===1?26:(th_arr[i].innerText.length===2?th_arr[i].innerText.length*22:th_arr[i].innerText.length*19),w4=td_arr[i].innerText.length===1?26:(td_arr[i].innerText.length===2?td_arr[i].innerText.length*22:td_arr[i].innerText.length*19),wid;wid=w1>w2?w1:w2;if(w3>w4){wid=wid>w3?wid:w3;}else{wid=wid>w4?wid:w4;}
el1.css('width',wid+'px');el2.css('width',wid+'px');}}
$element.find('div.mic-tables-div>table')[0].style.tableLayout='fixed';$element.find('table.th-tables')[0].style.tableLayout='fixed';var w=$element.find('table:first').width();$element.find('.mic-tables-thdiv')[0].style.width=w+'px';var e1=$element.find('table:last');var e2=$element.find('div.mic-tables-div');if(e1.height()>e2.height()){w+=17;}
$element.find('.mic-tables-div')[0].style.width=w+'px';},26);}
function setth1(){$timeout(function(){var scrollEl=$element.find('.mic-tables-div')[0];var tempArr=[];var tbs=$element.find('table');tbs.each(function(i,el){var node=angular.element(el).children().children().first().children();for(var j=0;j<node.length;j++){var item=node.get(j).childNodes[0];var l=item.innerText.length*13;if(i===1){var ls=angular.element(tempArr[j]).width();if(l<ls){l=ls;}else{tempArr[j].style.width=l+'px';}
item.style.width=l+'px';continue;}
tempArr.push(item);item.style.width=l+'px';}
if(i===1){var ft=$element.find('table:first');if(ft.width()>$element.width()){var scrollWidth=scrollEl.offsetWidth-scrollEl.scrollWidth;if(scrollWidth!==0){scrollWidth=17}
scrollEl.style.width=(ft.width()+scrollWidth)+'.33px';}}});},26);}
function setth2(){$timeout(function(){$element.find('div.mic-tables-div').css('height',$scope.tbodyHeight);$element.find('div.mic-tables-div')[0].style.width='auto';var first=$element.find('table:first>thead>tr>th');var last=$element.find('table:last>tbody>tr:first>td');if(last.length===0)return;if($element.find('table:first').width()<=$element.width()){var wt=$element.find('table:first').width();first.each(function(i,el1){var el11=angular.element(el1);var el22=angular.element(last[i]);var w11=el11.width();var w22=el22.width();if(w11>=w22){el22[0].childNodes[0].style.width=w11+'px';}else{el11[0].childNodes[0].style.width=w22+'px';}
var el2=angular.element(last[i])[0];var f=el2.offsetWidth/wt*100.000000;el1.style.width=f+'%';});$element.find('table.th-tables')[0].style.width=$element.find('div.mic-tables-div>table>').width()+'px';return;}
first.each(function(i,el){var el1=angular.element(el);var el2=angular.element(last[i]);var w1=el1.width();var w2=el2.width();if(w1>=w2){el2[0].childNodes[0].style.width=w1+'px';}else{el1[0].childNodes[0].style.width=w2+'px';}});var h=0;var e1=$element.find('table:last');var e2=$element.find('div.mic-tables-div');if(e1.height()>e2.height()){h=17;}
$element.find('div.mic-tables-div')[0].style.width=($element.find('table:first').width()+h)+'px';return;},26);}
$scope.$watch(function(){var len=$element.find('div.mic-tables-div>table>tbody>tr:last>td').length;len+=$element.find('div.mic-tables-div>table>tbody>tr').length;return $element.width()+window.innerWidth+len;},function(newValue,oldValue){if($element.attr('dynamic')!==undefined){setth11();}else{setth();}});$scope.cellClickFun=function(row,key,event,bo){if(angular.isFunction($scope.onDetailClick)){$scope.onDetailClick(row,key,event);}
if(bo)
$timeout(function(){if(event.target.localName!=='td')
angular.element(event.target).parent().children().first().select();else
angular.element(event.target).children().first().select();},50);};$scope.table_btn_click=function(row,index,name,evt){row.tableBtnParams[index].click(row,name,evt);};$scope.keydownTableInput=function(row,evt,i){if(evt.keyCode===13){row.isShowInput[i]=false;}};var selected_branch;$scope.tableSelected=function(row,evt,index){$scope.currentIndex=index;if($scope.onCellClick&&angular.isFunction($scope.onCellClick))$scope.onCellClick(row,evt);if(row!==selected_branch){if(selected_branch!=null){selected_branch.selected=false;}
row.selected=true;selected_branch=row;}};$scope.allischecked=!!$scope.allischecked;function retstr(str){str=str.replace(',"ischecked":true','').replace(',"ischecked":false','').replace(',"selected":true','').replace(',"selected":false','');return str;}
$scope.tableCheckClick=function(row){if(row){row.ischecked=!row.ischecked;if(row.ischecked){$scope.checkedData.push(row);if($scope.datasets.length===$scope.checkedData.length){$scope.allischecked=true;}}
else{var arr=[];for(var i=0;i<$scope.checkedData.length;i++){if(!!row.id&&row.id===$scope.checkedData[i].id){$scope.checkedData.splice(i,1);break;}else if(retstr(angular.toJson(row))===retstr(angular.toJson($scope.checkedData[i]))){$scope.checkedData.splice(i,1);break;}}
if($scope.checkedData.length===0){$scope.allischecked=false;}}}else{$scope.allischecked=!$scope.allischecked;for(var i in $scope.datasets){$scope.datasets[i].ischecked=$scope.allischecked;}
if($scope.allischecked)
$scope.checkedData=angular.copy($scope.datasets);else
$scope.checkedData=[];}};}],replace:true}});;'use strict';app.directive('textBox',function($timeout){return{restrict:'E',template:function(elem,attr){var templates='';if(!angular.isUndefined(attr.textLabel)){templates='<div class="form-group" style="margin-bottom: 5px;">'+'<label class="col-sm-2 col-xs-2 control-label" style="padding-top: 7px; margin-bottom: 0; text-align: right;">'+'{{textLabel}}'+'<span class="symbol required" ng-show="required"></span>'+'</label>'+'<div class="col-sm-10 col-xs-10 single-textbox" ng-init="isErrorClass = false" ng-class="{\'has-error\':isErrorClass}">'+'<input class="form-control" id="{{inputId}}" type="text" placeholder="{{textPlaceholder}}" ng-model="textModel" ng-readonly="textReadonly">'+'<a class="input-cancel" href="javascript:;" ng-class="{\'html-not-show\':!textModel.length>0||textReadonly}"><i class="fa fa-times" style="color: gray" ng-click="cleanInput()"></i></a>'+'<small style="color: #a94442;" ng-class="{\'is-error-show\':!isErrorClass||textReadonly}">{{textErrorMsg}}</small>'+'</div>'+'</div>';}
else{templates='<div class="form-group" style="margin-bottom: 5px;">'+'<div class="single-textbox" ng-init="isErrorClass = false" ng-class="{\'has-error\':isErrorClass}">'+'<input class="form-control" id="{{inputId}}" type="text" placeholder="{{textPlaceholder}}" ng-model="textModel" ng-readonly="textReadonly">'+'<a class="input-cancel" href="javascript:;" ng-class="{\'html-not-show\':!textModel.length>0||textReadonly}"><i class="fa fa-times" style="color: gray" ng-mousedown="cleanInput()"></i></a>'+'<small style="color: #a94442;" ng-class="{\'is-error-show\':!isErrorClass||textReadonly}">{{textErrorMsg}}</small>'+'</div>';}
return templates;},scope:{textModel:'=?',textPlaceholder:'=?',textLabel:'=?',textErrorMsg:'=?',required:'=?',textLength:'=?',textNotAllowed:'=?',textReadonly:'=?'},link:function(scope,elem,attr){var timer=new Date().getTime()+"_textbox";scope.inputId=angular.isUndefined(attr.id)?timer:attr.id;scope.textModel=angular.isUndefined(scope.textModel)?'':scope.textModel;scope.required=angular.isUndefined(scope.required)?false:scope.required;scope.textLength=angular.isUndefined(scope.textLength)?null:scope.textLength;scope.textNotAllowed=angular.isUndefined(scope.textNotAllowed)?"":scope.textNotAllowed;scope.textReadonly=angular.isUndefined(scope.textReadonly)?false:scope.textReadonly;scope.textErrorMsg="initial";elem.children().children('input').bind('mousedown',function(){$timeout(function(){scope.isErrorClass=false;},0);});elem.children().children('input').bind('keyup',function(){if(scope.textNotAllowed){$timeout(judgeContent,0);}
if(scope.textLength>0&&!isNaN(scope.textLength)){$timeout(judgeLength,0);}});elem.children().children('input').bind('blur',function(){if(scope.textNotAllowed){$timeout(judgeContent,0);}
if(scope.textLength>0&&!isNaN(scope.textLength)){$timeout(judgeLength,0);}
if(scope.required){$timeout(judgeNull,0);}});scope.cleanInput=function(){scope.textModel="";scope.isErrorClass=false;if(scope.required){$timeout(judgeNull,0);}}
var judgeNull=function(){if(!scope.textModel){scope.textErrorMsg="必填项！";scope.isErrorClass=true;}}
var judgeLength=function(){if(scope.textLength<scope.textModel.length){scope.textErrorMsg="超过长度限制！";scope.isErrorClass=true;}}
var judgeContent=function(){var tmpString=scope.textNotAllowed.split("");for(var i=0;i<tmpString.length;i++){if(scope.textModel.indexOf(tmpString[i])>-1){scope.textErrorMsg="存在非法字符！";scope.isErrorClass=true;break;}}}},transclude:true,replace:true}});;'use strict';app.factory('ToggleHelper',['$rootScope',function($rootScope){return{events:{toggle:"clip-two.toggle",toggleByClass:"clip-two.toggleByClass",togglerLinked:"clip-two.linked",toggleableToggled:"clip-two.toggled"},commands:{alternate:"toggle",activate:"on",deactivate:"off"},toggle:function(target,command){if(command==null){command="toggle";}
$rootScope.$emit(this.events.toggle,target,command);},toggleByClass:function(targetClass,command){if(command==null){command="toggle";}
$rootScope.$emit(this.events.toggleByClass,targetClass,command);},notifyToggleState:function(elem,attrs,toggleState){$rootScope.$emit(this.events.toggleableToggled,attrs.id,toggleState,attrs.exclusionGroup);},toggleStateChanged:function(elem,attrs,toggleState){this.updateElemClasses(elem,attrs,toggleState);this.notifyToggleState(elem,attrs,toggleState);},applyCommand:function(command,oldState){switch(command){case this.commands.activate:return true;case this.commands.deactivate:return false;case this.commands.alternate:return!oldState;}},updateElemClasses:function(elem,attrs,active){if(active){if(attrs.activeClass){elem.addClass(attrs.activeClass);}
if(attrs.inactiveClass){elem.removeClass(attrs.inactiveClass);}
var parent=elem.parent();if(attrs.parentActiveClass){parent.addClass(attrs.parentActiveClass);}
if(attrs.parentInactiveClass){parent.removeClass(attrs.parentInactiveClass);}}else{if(attrs.inactiveClass){elem.addClass(attrs.inactiveClass);}
if(attrs.activeClass){elem.removeClass(attrs.activeClass);}
var parent=elem.parent();if(attrs.parentInactiveClass){parent.addClass(attrs.parentInactiveClass);}
if(attrs.parentActiveClass){parent.removeClass(attrs.parentActiveClass);}}}};}]).run(["$rootScope","ToggleHelper",function($rootScope,ToggleHelper){$rootScope.toggle=function(target,command){if(command==null){command="toggle";}
ToggleHelper.toggle(target,command);};$rootScope.toggleByClass=function(targetClass,command){if(command==null){command="toggle";}
ToggleHelper.toggleByClass(targetClass,command);};}]).directive('ctToggle',["$rootScope","ToggleHelper",function($rootScope,ToggleHelper){return{restrict:"A",link:function(scope,elem,attrs){var command=attrs.ctToggle||ToggleHelper.commands.alternate;var target=attrs.target;var targetClass=attrs.targetClass;var bubble=attrs.bubble==="true"||attrs.bubble==="1"||attrs.bubble===1||attrs.bubble===""||attrs.bubble==="bubble";if((!target)&&attrs.href){target=attrs.href.slice(1);}
if(!(target||targetClass)){throw"'target' or 'target-class' attribute required with 'ct-toggle'";}
elem.on("click tap",function(e){var angularElem=angular.element(e.target);if(!angularElem.hasClass("disabled")){if(target!=null){ToggleHelper.toggle(target,command);}
if(targetClass!=null){ToggleHelper.toggleByClass(targetClass,command);}
if(!bubble){e.preventDefault();return false;}else{return true;}}});var unbindUpdateElemClasses=$rootScope.$on(ToggleHelper.events.toggleableToggled,function(e,id,newState){if(id===target){ToggleHelper.updateElemClasses(elem,attrs,newState);}});if(target!=null){$rootScope.$emit(ToggleHelper.events.togglerLinked,target);}
scope.$on('$destroy',unbindUpdateElemClasses);}};}]).directive('toggleable',["$rootScope","ToggleHelper",function($rootScope,ToggleHelper){return{restrict:"A",link:function(scope,elem,attrs){var toggleState=false;if(attrs["default"]){switch(attrs["default"]){case"active":toggleState=true;break;case"inactive":toggleState=false;}
ToggleHelper.toggleStateChanged(elem,attrs,toggleState);}
var unbindToggle=$rootScope.$on(ToggleHelper.events.toggle,function(e,target,command){var oldState;if(target===attrs.id){oldState=toggleState;toggleState=ToggleHelper.applyCommand(command,oldState);if(oldState!==toggleState){ToggleHelper.toggleStateChanged(elem,attrs,toggleState);}}});var unbindToggleByClass=$rootScope.$on(ToggleHelper.events.toggleByClass,function(e,targetClass,command){var oldState;if(elem.hasClass(targetClass)){oldState=toggleState;toggleState=ToggleHelper.applyCommand(command,oldState);if(oldState!==toggleState){ToggleHelper.toggleStateChanged(elem,attrs,toggleState);}}});var unbindToggleableToggled=$rootScope.$on(ToggleHelper.events.toggleableToggled,function(e,target,newState,sameGroup){if(newState&&(attrs.id!==target)&&(attrs.exclusionGroup===sameGroup)&&(attrs.exclusionGroup!=null)){toggleState=false;ToggleHelper.toggleStateChanged(elem,attrs,toggleState);}});var unbindTogglerLinked=$rootScope.$on(ToggleHelper.events.togglerLinked,function(e,target){if(attrs.id===target){ToggleHelper.notifyToggleState(elem,attrs,toggleState);}});scope.$on('$destroy',function(){unbindToggle();unbindToggleByClass();unbindToggleableToggled();unbindTogglerLinked();});}};}]);;'use strict';app.directive('touchspin',function(){return{restrict:'EA',link:function(scope,elem,attr){var tsOptions=['initval','min','max','step','forcestepdivisibility','decimals','stepinterval','stepintervaldelay','verticalbuttons','verticalupclass','verticaldownclass','prefix','postfix','prefix_extraclass','postfix_extraclass','booster','boostat','maxboostedstep','mousewheel','buttondown_class','buttonup_class'];var options={};for(var i=0,l=tsOptions.length;i<l;i++){var opt=tsOptions[i];if(attr[opt]!==undefined){options[opt]=attr[opt];}}
elem.TouchSpin(options);}};});;'use strict';app.directive('micUiModals',function($modal){var popWin=function(tpl,ctrl,size,winCls,backdrop,resolve,openedFun){if(backdrop===undefined||backdrop===null||backdrop===''||backdrop!=='static'){backdrop=true;}
if(resolve==='map'){resolve=loadSequences('openlayerjs','itellurojs');}
var m=$modal.open({template:tpl,controller:ctrl,backdrop:backdrop,size:size,windowClass:winCls,resolve:resolve?resolve:{}});m.opened.then(function(a){if(!openedFun||!angular.isFunction(openedFun)){return;}
openedFun(a);});};function loadSequences(){var _args=arguments;return{deps:['$ocLazyLoad','$q',function($ocLL,$q){var promise=$q.when(1);for(var i=0,len=_args.length;i<len;i++){promise=promiseThen(_args[i]);}
return promise;function promiseThen(_arg){if(typeof _arg=='function')
return promise.then(_arg);else
return promise.then(function(){var nowLoad=requiredData(_arg);if(!nowLoad)
return $.error('Route resolve: Bad resource name ['+_arg+']');return $ocLL.load(nowLoad);});}
function requiredData(name){if(jsRequires.modules)
for(var m in jsRequires.modules)
if(jsRequires.modules[m].name&&jsRequires.modules[m].name===name)
return jsRequires.modules[m];return jsRequires.scripts&&jsRequires.scripts[name];}}]};}
return{restrict:'E',template:'<div ng-click="openPopwinFun()" ng-transclude>'+'</div>',scope:{popwinTitle:'=?',popwinIcon:'=?',popwinmodal:'=?',resolve:'@?',templateUrl:'@?',template:'=?',size:'@?',winClass:'@?',backdrop:'=?',onOpened:'=?',onSubmit:'=?',onCancel:'=?',openPopwinFun:'=?',},replace:true,transclude:true,controller:function($scope,SweetAlert,$templateCache){function _rdom(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);}
$scope.ctrl='popwinsCtrl_'+_rdom()+'_'+new Date().getTime();$scope.openPopwinFun=function(){var tmls=$scope.template?$scope.template:'    <!-- 表单 -->'+'    <form role="form" class="form-horizontal" name="$popwin_form" novalidate ng-submit="submitForm.submit($popwin_form)">'+
$templateCache.get($scope.templateUrl)+'        <div class="form-group" style="margin-top: 50px;margin-bottom: 0px; margin-right: 0px;">'+'            <button type="submit" style="min-width: 80px; float: right; margin-left: 0.5em;" class="btn btn-wide btn-primary">提交</button>'+'            <a style="float: right; min-width: 80px;" class="btn btn-wide btn-o btn-default" ng-click="submitForm.cancel()">取消</a>'+'        </div>'+'    </form>';tmls='<!-- Head -->'+'<div class="modal-header" style="padding:10px">'+'    <h4 style="margin-bottom: 0px;" ng-class="icon">{{title}}</h4>'+'    <a class="my-pop-win-close" href="#" ng-click="closePop()"><i class="ti-close" tooltip="关闭"></i></a>'+'</div>'+'<!-- Body -->'+'<div class="modal-body form-error">'+
tmls+'</div>';popWin(tmls,$scope.ctrl,$scope.size,$scope.winClass,$scope.backdrop,$scope.resolve,$scope.onOpened);};},link:function($scope,$element,$attributes){var mod={ppl:$scope.popwinmodal,ttl:$scope.popwinTitle,icon:$scope.popwinIcon},onSubmit=$scope.onSubmit,onCancel=$scope.onCancel;$scope.$watch('popwinmodal',function(val){mod.ppl=val;});$scope.$watch('popwinTitle',function(val){mod.ttl=val;});$scope.$watch('popwinIcon',function(val){mod.icon=val;});app.controller($scope.ctrl,['$scope','$modalInstance','SweetAlert',function($scope,$modalInstance,SweetAlert){$scope.$modalInstance=$modalInstance;$scope.popwinmodal=mod.ppl;$scope.title=mod.ttl;$scope.icon=mod.icon;$scope.$watch(function(){return mod;},function(val){$scope.title=val.ttl;$scope.icon=val.icon;$scope.popwinmodal=val.ppl;});$modalInstance.result.finally(function(){$scope.submitForm.cancel();});$scope.submitForm={submit:function(form){if(form.$invalid){var field=null,firstError=null;for(field in form){if(field[0]!='$'){if(firstError===null&&!form[field].$valid){firstError=form[field].$name;}
if(form[field].$pristine){form[field].$dirty=true;}}}
return;}else{if(!!onSubmit&&angular.isFunction(onSubmit))
onSubmit($modalInstance,form);else if(!!onSubmit&&!!onSubmit.submit&&angular.isFunction(onSubmit.submit))
onSubmit.submit($modalInstance,form);}},cancel:function(){if(!!onCancel&&angular.isFunction(onCancel))
onCancel($modalInstance);else if(!!onSubmit&&!!onSubmit.cancel&&angular.isFunction(onSubmit.cancel)){onSubmit.cancel($modalInstance);return;}
$modalInstance.dismiss('cancel');}};$scope.closePop=function(){$scope.submitForm.cancel();};}]);}}});;'use strict';app.directive('micUpload',function(){return{restrict:'E',template:function(){var tmp='<div style="border:solid 1px #eeeeee;padding:20px;" uploader="myUploader" filters="customFilter">\r\n'+'    <p style="height: 34px;">\r\n'+'        <span>文件个数: {{ myUploader.queue.length + editData.files.length }}</span>\r\n'+'        <span style="margin-left:10%;" class="btn btn-primary btn-o btn-file" >\r\n'+'           <i class="ti-plus"></i>选择多个文件\r\n'+'           <input type="file" nv-file-select="" uploader="myUploader" multiple />\r\n'+'        </span>\r\n'+'        <span style="margin-left: 0.2%;" class="btn btn-primary btn-o btn-file" >\r\n'+'           <i class="ti-plus"></i>选择单个文件\r\n'+'           <input type="file" nv-file-select="" uploader="myUploader" />\r\n'+'        </span>\r\n'+'        <small style="color:#5b5b60;">{{tiphot}}</small>\r\n'+'        <button type="button" style="float: right; margin-left: 0.3%; margin-right: 1.2%; " class="btn btn-primary btn-o btn-s " ng-click="delAll()" ng-disabled="!editData.files.length && !myUploader.queue.length">\r\n'+'           <span class="glyphicon glyphicon-trash"></span> 删除所有\r\n'+'        </button>\r\n'+'        <button type="button" style="float: right;" class="btn btn-primary btn-s" ng-click="myUploader.uploadAll()" ng-disabled="!myUploader.getNotUploadedItems().length">\r\n'+'           <span class="glyphicon glyphicon-upload"></span> 上传所有\r\n'+'        </button>\r\n'+'    </p>\r\n'+'    <div>\r\n'+'        <div class="table-responsive">\r\n'+'            <table class="table">\r\n'+'                <thead>\r\n'+'                    <tr>\r\n'+'                        <th width="50%">名称</th>\r\n'+'                        <th ng-show="myUploader.isHTML5">大小</th>\r\n'+'                        <th ng-show="myUploader.isHTML5">上传进度</th>\r\n'+'                        <th class="text-center">状态</th>\r\n'+'                        <th>操作</th>\r\n'+'                    </tr>\r\n'+'                </thead>\r\n'+'                <tbody>\r\n'+'                    <tr ng-repeat="item in myUploader.queue">\r\n'+'                        <td>\r\n'+'                            {{ item.file.name }}\r\n'+'                        </td>\r\n'+'                        <td ng-show="myUploader.isHTML5" nowrap>\r\n'+'                            <span ng-if="(item.file.size/1024/1024|number:2)>1">{{ item.file.size/1024/1024|number:2 }} MB</span>\r\n'+'                            <span ng-if="(item.file.size/1024|number:2)>1">{{ item.file.size/1024|number:2 }} KB</span>\r\n'+'                            <span ng-if="(item.file.size|number:2)>1">{{ item.file.size|number:2 }} B</span>\r\n'+'                        </td>\r\n'+'                        <td ng-show="myUploader.isHTML5">\r\n'+'                            <div class="progress progress-xs margin-bottom-0">\r\n'+'                                <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }"></div>\r\n'+'                            </div>\r\n'+'                        </td>\r\n'+'                        <td class="text-center">\r\n'+'                            <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>\r\n'+'                            <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>\r\n'+'                            <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>\r\n'+'                        </td>\r\n'+'                        <td nowrap>\r\n'+'                            <button type="button" class="btn btn-success btn-xs" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess">\r\n'+'                                <span class="glyphicon glyphicon-upload"></span> 上传\r\n'+'                            </button>\r\n'+'                            <button type="button" class="btn btn-danger btn-xs" ng-click="del(null, item)">\r\n'+'                                <span class="glyphicon glyphicon-trash"></span> 删除\r\n'+'                            </button>\r\n'+'                        </td>\r\n'+'                    </tr>\r\n'+'                    <tr ng-repeat="row in editData.files">\r\n'+'                        <td>\r\n'+'                            {{row.physicalName }}\r\n'+'                        </td>\r\n'+'                        <td>\r\n'+'                            <span ng-if="(row.fileSize/1024/1024|number:2)>1">{{ row.fileSize/1024/1024|number:2 }} MB</span>\r\n'+'                            <span ng-if="(row.fileSize/1024|number:2)>1">{{ row.fileSize/1024|number:2 }} KB</span>\r\n'+'                            <span ng-if="(row.fileSize|number:2)>1">{{ row.fileSize|number:2 }} B</span>\r\n'+'                        </td>\r\n'+'                        <td>\r\n'+'                            <div class="progress progress-xs margin-bottom-0">\r\n'+'                                <div class="progress-bar" role="progressbar" ng-style="{ \'width\': \'100%\' }"></div>\r\n'+'                            </div>\r\n'+'                        </td>\r\n'+'                        <td class="text-center">\r\n'+'                            <span><i class="glyphicon glyphicon-ok"></i></span>\r\n'+'                        </td>\r\n'+'                        <td nowrap>\r\n'+'                            <button type="button" class="btn btn-success btn-xs" ng-disabled="1">\r\n'+'                                <span class="glyphicon glyphicon-upload"></span> 上传\r\n'+'                            </button>\r\n'+'                            <button type="button" class="btn btn-danger btn-xs" ng-click="del(row)">\r\n'+'                                <span class="glyphicon glyphicon-trash"></span> 删除\r\n'+'                            </button>\r\n'+'                        </td>\r\n'+'                    </tr>\r\n'+'                </tbody>\r\n'+'            </table>\r\n'+'        </div>上传总进度:\r\n'+'        <div  class="progress progress-xs margin-top-5 margin-bottom-20">\r\n'+'           <div class="progress-bar" role="progressbar" ng-style="{ \'width\': myUploader.progress + \'%\' }"></div>\r\n'+'        </div>\r\n'+'   </div>\r\n'+'</div>';return tmp;},scope:{editData:'=?',tiphot:'@?',fileType:'@?',fileSize:'=?',onSuccess:'=?',onDelAll:'=?',onDelSingle:'=?',onAfterAddingfile:'=?',onAfterAddingall:'=?',},replace:true,controller:['$scope','FileUploader','SweetAlert','abp.services.app.attachment',function($scope,FileUploader,SweetAlert,attachment){$scope.myUploader=new FileUploader({url:'upload'});$scope.myUploader.filters.push({name:'customFilter',fn:function(item){if($scope.fileType){var name=item.name.split('.');var b=$scope.fileType.indexOf(name[name.length-1])===-1;if(b){SweetAlert.swal({title:"请上传指定类型的文件",text:"允许上传的类型："+$scope.fileType,type:"warning",confirmButtonColor:"#007AFF"});return!b;}}
if($scope.fileSize){var b=item.size>$scope.fileSize;if(b){var c=$scope.fileSize/1024/1024;SweetAlert.swal({title:"请上传小于指定大小的文件",text:"单个文件不得大于"+c+'MB！',type:"warning",confirmButtonColor:"#007AFF"});return!b;}}
return true;}});$scope.myUploader.onWhenAddingFileFailed=function(item,filter,options){};$scope.myUploader.onAfterAddingFile=function(fileItem){$scope.onAfterAddingfile?$scope.onAfterAddingfile(fileItem):null;};$scope.myUploader.onAfterAddingAll=function(addedFileItems){$scope.onAfterAddingall?$scope.onAfterAddingall(addedFileItems):null;};$scope.myUploader.onBeforeUploadItem=function(item){};$scope.myUploader.onProgressItem=function(fileItem,progress){};$scope.myUploader.onProgressAll=function(progress){};$scope.myUploader.onSuccessItem=function(fileItem,response,status,headers){$scope.onSuccess(response);};$scope.myUploader.onErrorItem=function(fileItem,response,status,headers){console.info('onErrorItem',fileItem,response,status,headers);};$scope.myUploader.onCancelItem=function(fileItem,response,status,headers){console.info('onCancelItem',fileItem,response,status,headers);};$scope.myUploader.onCompleteItem=function(fileItem,response,status,headers){};$scope.myUploader.onCompleteAll=function(){};$scope.delAll=function(){SweetAlert.swal({title:"确定要删除所有吗?",text:"",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消"},function(isConfirm){if(isConfirm){attachment.deleteAllByFKId($scope.editData.id).success(function(data,status){$scope.editData.files=angular.copy([]);if($scope.myUploader.queue.length){$scope.myUploader.clearQueue();}
$scope.onDelAll();}).error(function(data,status){});}});};$scope.del=function(row,item){SweetAlert.swal({title:"确定要进行删除操作吗?",text:"",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消"},function(isConfirm){if(isConfirm){if(item){item.remove();$scope.onDelSingle(item);return;}
attachment.delete(row.id).success(function(data,status){var i,dt=angular.copy($scope.editData);for(i=0;i<dt.files.length;i++){if(dt.files[i].logicName===row.logicName){break;}}
dt.files.splice(i,1);$scope.editData=dt;$scope.onDelSingle(dt);}).error(function(data,status){});}});};}]}});;'use strict';app.directive('texteditor',function($timeout){return{restrict:'A',scope:{textModel:'=?',textMenu:'=?',isFixed:'=?'},link:function(scope,elem,attr,ctrl){var editor=new wangEditor(elem);editor.config.uploadImgUrl='upload';editor.config.uploadImgFileName='file';editor.config.uploadImgFns.onload=function(resultText,xhr){var jsonText=angular.fromJson(resultText);editor.command(null,'insertHtml','<img src="'+jsonText.httpPath+'" alt="'+jsonText.logicName+'" />');}
editor.config.uploadHeaders={'Accept':'text/x-json'};if(!angular.isUndefined(scope.textMenu)){editor.config.menus=scope.textMenu;}
if(!angular.isUndefined(scope.isFixed)){editor.config.menuFixed=scope.isFixed;if(scope.isFixed){editor.config.menuFixed=70;}}
else{editor.config.menuFixed=false;}
editor.onchange=function(){scope.$apply(function(){var html=editor.$txt.html();scope.textModel=html;});}
editor.create();scope.$watch('textModel',function(d){if(!!d){editor.$txt.html(d);}},true);if(!angular.isUndefined(attr.enable)){if(attr.enable=="true"){editor.enable();}
if(attr.enable=="false"){editor.disable();}}}}});